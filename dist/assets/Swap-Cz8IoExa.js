import{c as O,E as Y,r as n,z as d,j as e,e as H}from"./index-Cb_Vey4A.js";import{L as C}from"./loader-2-CvgjdlF_.js";import{R as X}from"./refresh-cw-DbeEGu-Y.js";const q=O("ArrowDownUp",[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"m21 8-4-4-4 4",key:"1c9v7m"}],["path",{d:"M17 4v16",key:"7dpous"}]]),i={BTC:{symbol:"BTC",name:"Bitcoin",icon:"â‚¿"},TYT:{symbol:"TYT",name:"TYT Token",icon:"ðŸ¦‰"},USDT:{symbol:"USDT",name:"Tether",icon:"â‚®"},ETH:{symbol:"ETH",name:"Ethereum",icon:"Îž"},SOL:{symbol:"SOL",name:"Solana",icon:"â—Ž"},TRX:{symbol:"TRX",name:"TRON",icon:"â¬£"}};function z(){const{user:c}=Y(),[t,u]=n.useState(null),[a,p]=n.useState(null),[l,m]=n.useState(""),[x,b]=n.useState(""),[y,D]=n.useState(0),[f,j]=n.useState(!1),[A,T]=n.useState(!1),[w,E]=n.useState(.5),[g,M]=n.useState(.3),[N,F]=n.useState({}),[S,R]=n.useState([]);n.useEffect(()=>{c&&(v(),_())},[c]),n.useEffect(()=>{t&&a&&l&&k()},[t,a,l]);const v=async()=>{if(!c)return;const{data:s,error:r}=await d.from("custodial_wallets").select("asset, balance").eq("user_id",c.id);if(s){const o={};s.forEach(h=>{o[h.asset]=parseFloat(h.balance||"0")}),F(o),!t&&o.USDT!==void 0&&u({...i.USDT,balance:o.USDT}),!a&&o.TYT!==void 0&&p({...i.TYT,balance:o.TYT})}},_=async()=>{if(!c)return;const{data:s}=await d.from("custodial_internal_swaps").select("*").eq("user_id",c.id).order("created_at",{ascending:!1}).limit(10);s&&R(s)},k=async()=>{if(!(!t||!a||!l)){T(!0);try{await new Promise(h=>setTimeout(h,500));const r={BTC:{USDT:45e3,TYT:9e5,ETH:15,SOL:450,TRX:45e4},USDT:{BTC:22e-6,TYT:20,ETH:33e-5,SOL:.01,TRX:10},TYT:{BTC:11e-7,USDT:.05,ETH:17e-6,SOL:5e-4,TRX:.5},ETH:{BTC:.067,USDT:3e3,TYT:6e4,SOL:30,TRX:3e4},SOL:{BTC:.0022,USDT:100,TYT:2e3,ETH:.033,TRX:1e3},TRX:{BTC:22e-7,USDT:.1,TYT:2,ETH:33e-6,SOL:.001}}[t.symbol]?.[a.symbol]||1;D(r);const o=parseFloat(l)*r*(1-g/100);b(o.toFixed(6))}catch(s){console.error("Failed to fetch rate:",s)}finally{T(!1)}}},L=async()=>{if(!(!c||!t||!a||!l||!x)){j(!0);try{const{data:s}=await d.from("custodial_wallets").select("id").eq("user_id",c.id).eq("asset",t.symbol).single(),{data:r}=await d.from("custodial_wallets").select("id").eq("user_id",c.id).eq("asset",a.symbol).single();if(!s||!r)throw new Error("Wallets not found");const{error:o}=await d.from("custodial_internal_swaps").insert({user_id:c.id,from_wallet_id:s.id,to_wallet_id:r.id,from_asset:t.symbol,to_asset:a.symbol,from_amount:parseFloat(l),to_amount:parseFloat(x),exchange_rate:y,swap_fee:parseFloat(l)*g/100,rate_provider:"internal",status:"completed"});if(o)throw o;alert("Swap completed successfully!"),m(""),b(""),v(),_()}catch(s){console.error("Swap error:",s),alert(s.message||"Swap failed")}finally{j(!1)}}},U=()=>{const s=t;u(a),p(s),m(x),b(l)},B=()=>{t&&m(t.balance.toString())};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Token Swap"}),e.jsx("p",{className:"text-gray-400",children:"Exchange tokens instantly within your wallet"})]}),e.jsx("div",{className:"bg-gradient-to-br from-gray-800/50 to-gray-900/50 rounded-xl p-8 border border-gray-700/50",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-4 border border-gray-700/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"From"}),e.jsxs("span",{className:"text-sm text-gray-400",children:["Balance: ",t?.balance.toFixed(6)||"0.00"]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("select",{value:t?.symbol||"",onChange:s=>{const r=i[s.target.value];r&&u({...r,balance:N[r.symbol]||0})},className:"px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-[#D2A44C]",children:[e.jsx("option",{value:"",children:"Select token"}),Object.values(i).map(s=>e.jsxs("option",{value:s.symbol,children:[s.icon," ",s.symbol]},s.symbol))]}),e.jsx("input",{type:"number",value:l,onChange:s=>m(s.target.value),placeholder:"0.00",className:"flex-1 px-4 py-2 bg-transparent text-white text-xl font-bold focus:outline-none"}),e.jsx("button",{onClick:B,className:"px-3 py-1 bg-[#D2A44C]/20 text-[#D2A44C] rounded text-sm hover:bg-[#D2A44C]/30",children:"MAX"})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{onClick:U,className:"p-3 rounded-full bg-gray-800 border border-gray-700 hover:border-[#D2A44C] hover:bg-gray-700 transition-all",children:e.jsx(q,{className:"w-5 h-5 text-[#D2A44C]"})})}),e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-4 border border-gray-700/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"To"}),e.jsxs("span",{className:"text-sm text-gray-400",children:["Balance: ",a?.balance.toFixed(6)||"0.00"]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("select",{value:a?.symbol||"",onChange:s=>{const r=i[s.target.value];r&&p({...r,balance:N[r.symbol]||0})},className:"px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-[#D2A44C]",children:[e.jsx("option",{value:"",children:"Select token"}),Object.values(i).map(s=>e.jsxs("option",{value:s.symbol,children:[s.icon," ",s.symbol]},s.symbol))]}),e.jsx("div",{className:"flex-1 text-right",children:A?e.jsx(C,{className:"w-5 h-5 animate-spin text-gray-400"}):e.jsx("span",{className:"text-xl font-bold text-white",children:x||"0.00"})})]})]}),t&&a&&l&&e.jsx("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-4",children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between text-gray-300",children:[e.jsx("span",{children:"Exchange Rate:"}),e.jsxs("span",{className:"text-white font-medium",children:["1 ",t.symbol," = ",y.toFixed(6)," ",a.symbol]})]}),e.jsxs("div",{className:"flex items-center justify-between text-gray-300",children:[e.jsx("span",{children:"Swap Fee:"}),e.jsxs("span",{className:"text-white font-medium",children:[g,"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-gray-300",children:[e.jsx("span",{children:"Slippage Tolerance:"}),e.jsxs("span",{className:"text-white font-medium",children:[w,"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-gray-300",children:[e.jsx("span",{children:"Price Impact:"}),e.jsx("span",{className:"text-green-400 font-medium",children:"<0.01%"})]})]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Slippage:"}),[.1,.5,1].map(s=>e.jsxs("button",{onClick:()=>E(s),className:`px-3 py-1 rounded text-sm ${w===s?"bg-[#D2A44C] text-white":"bg-gray-800 text-gray-400 hover:bg-gray-700"}`,children:[s,"%"]},s))]}),e.jsx("button",{onClick:L,disabled:f||!t||!a||!l||parseFloat(l)<=0||parseFloat(l)>(t?.balance||0),className:"w-full py-4 bg-gradient-to-r from-[#D2A44C] to-yellow-600 text-white font-bold rounded-lg hover:shadow-lg hover:shadow-[#D2A44C]/20 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:f?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"w-5 h-5 animate-spin"}),"Swapping..."]}):e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"w-5 h-5"}),"Swap Tokens"]})})]})}),e.jsxs("div",{className:"bg-gradient-to-br from-gray-800/50 to-gray-900/50 rounded-xl p-6 border border-gray-700/50",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Recent Swaps"}),e.jsx("div",{className:"space-y-3",children:S.length===0?e.jsx("div",{className:"text-center py-8 text-gray-400",children:"No swaps yet"}):S.map(s=>e.jsx("div",{className:"bg-gray-800/50 rounded-lg p-4 border border-gray-700/50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(H,{className:"w-5 h-5 text-[#D2A44C]"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-white font-medium",children:[s.from_amount," ",s.from_asset," â†’ ",s.to_amount," ",s.to_asset]}),e.jsx("div",{className:"text-xs text-gray-400",children:new Date(s.created_at).toLocaleString()})]})]}),e.jsx("div",{className:"text-sm",children:e.jsx("span",{className:"text-green-400",children:"Completed"})})]})},s.id))})]})]})}export{z as default};
