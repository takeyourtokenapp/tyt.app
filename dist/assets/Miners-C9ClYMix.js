import{E as T,r as c,z as g,j as e,I as y,e as D,Z as C,D as P,A as f,d as M,b as k,O as S,g as F}from"./index-Cb_Vey4A.js";const E=[{name:"Bronze",coverageDays:30,discountPct:2},{name:"Silver",coverageDays:90,discountPct:5},{name:"Gold",coverageDays:180,discountPct:9},{name:"Platinum",coverageDays:270,discountPct:13},{name:"Diamond",coverageDays:360,discountPct:18}];function R(r){const{hashrateTerahash:t,efficiencyWattsPerTh:d,kwhPriceUsd:n,serviceFeeUsd:l}=r;return d*t*24/1e3*n+l}function q(r,t){if(r<=0||t<=0)return null;const d=r/t;let n=null;for(const l of E)d>=l.coverageDays&&(n=l);return n}function H(){const{user:r}=T(),[t,d]=c.useState([]),[n,l]=c.useState([]),[h,b]=c.useState(!0),[u,j]=c.useState(0),[x,m]=c.useState(null);c.useEffect(()=>{r&&v()},[r]);const v=async()=>{if(r)try{const[s,a,i]=await Promise.all([g.from("nft_miners").select("*").eq("owner_id",r.id).order("created_at",{ascending:!1}),g.from("maintenance_invoices").select("*, nft_miners!inner(owner_id)").eq("nft_miners.owner_id",r.id).eq("status","pending").order("due_date",{ascending:!0}),g.from("custodial_wallets").select("balance").eq("user_id",r.id).eq("asset","TYT").maybeSingle()]);s.data&&d(s.data),a.data&&l(a.data),i.data&&j(parseFloat(i.data.balance))}catch(s){console.error("Error loading miners:",s)}finally{b(!1)}},N=s=>{switch(s){case"active":return"bg-green-500/20 text-green-400 border-green-500/50";case"inactive":return"bg-gray-500/20 text-gray-400 border-gray-500/50";case"maintenance_due":return"bg-yellow-500/20 text-yellow-400 border-yellow-500/50";case"delinquent":return"bg-red-500/20 text-red-400 border-red-500/50";default:return"bg-gray-500/20 text-gray-400 border-gray-500/50"}},p=t.reduce((s,a)=>s+a.hashrate_th,0),w=t.length>0?t.reduce((s,a)=>s+a.efficiency_w_per_th,0)/t.length:0,_=t.filter(s=>s.status==="active").length;return h?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-gray-400",children:"Loading miners..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"My Miners"}),e.jsx("p",{className:"text-gray-400",children:"Manage your NFT miners and maintenance"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl p-6 border border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"text-gray-400 text-sm",children:"Total Miners"}),e.jsx(y,{className:"w-5 h-5 text-amber-400"})]}),e.jsx("div",{className:"text-3xl font-bold text-amber-400",children:t.length}),e.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:[_," active"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl p-6 border border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"text-gray-400 text-sm",children:"Total Hashrate"}),e.jsx(D,{className:"w-5 h-5 text-amber-400"})]}),e.jsx("div",{className:"text-3xl font-bold text-amber-400",children:p.toFixed(2)}),e.jsx("div",{className:"text-xs text-gray-500 mt-2",children:"TH/s"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl p-6 border border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"text-gray-400 text-sm",children:"Avg Efficiency"}),e.jsx(C,{className:"w-5 h-5 text-amber-400"})]}),e.jsx("div",{className:"text-3xl font-bold text-amber-400",children:w.toFixed(1)}),e.jsx("div",{className:"text-xs text-gray-500 mt-2",children:"W/TH"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl p-6 border border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"text-gray-400 text-sm",children:"Pending Invoices"}),e.jsx(P,{className:"w-5 h-5 text-amber-400"})]}),e.jsx("div",{className:"text-3xl font-bold text-amber-400",children:n.length}),e.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:["$",n.reduce((s,a)=>s+parseFloat(a.final_amount_usd),0).toFixed(2)]})]})]}),n.length>0&&e.jsx("div",{className:"bg-yellow-500/10 border border-yellow-500/50 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(f,{className:"w-5 h-5 text-yellow-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-yellow-400 mb-2",children:"Maintenance Required"}),e.jsxs("p",{className:"text-gray-300 mb-4",children:["You have ",n.length," pending maintenance invoice",n.length!==1?"s":"",". Pay to keep your miners active and earning rewards."]}),e.jsxs("button",{className:"px-6 py-2 bg-yellow-500 text-black rounded-lg font-semibold hover:bg-yellow-400 transition-all",children:["Pay All ($",n.reduce((s,a)=>s+parseFloat(a.final_amount_usd),0).toFixed(2),")"]})]})]})}),t.length===0?e.jsxs("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl p-12 border border-gray-700 text-center",children:[e.jsx(y,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"No Miners Yet"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"Purchase your first NFT miner to start earning daily BTC rewards"}),e.jsxs("button",{className:"px-8 py-3 bg-gradient-to-r from-amber-500 to-amber-600 rounded-lg font-semibold hover:shadow-lg hover:shadow-amber-500/50 transition-all inline-flex items-center gap-2",children:["Browse Marketplace ",e.jsx(M,{size:20})]})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:t.map(s=>{const a=R({hashrateTerahash:s.hashrate_th,efficiencyWattsPerTh:s.efficiency_w_per_th,kwhPriceUsd:.08,serviceFeeUsd:2}),i=q(u,a);return e.jsxs(k,{to:`/app/miners/${s.id}`,className:"bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl p-6 border border-gray-700 hover:border-amber-500/50 transition-all block",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold mb-1",children:["Miner #",s.id.slice(0,8)]}),e.jsxs("div",{className:`inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold border ${N(s.status)}`,children:[s.status==="active"&&e.jsx(S,{size:14}),s.status==="maintenance_due"&&e.jsx(f,{size:14}),s.status]})]}),e.jsx("button",{onClick:o=>{o.preventDefault(),m(s)},className:"p-2 hover:bg-gray-700 rounded-lg transition-colors",children:e.jsx(F,{size:20})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Hashrate"}),e.jsxs("div",{className:"text-lg font-bold text-amber-400",children:[s.hashrate_th," TH/s"]})]}),e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Efficiency"}),e.jsxs("div",{className:"text-lg font-bold text-amber-400",children:[s.efficiency_w_per_th," W/TH"]})]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Daily Cost:"}),e.jsxs("span",{className:"font-semibold",children:["$",a.toFixed(2)]})]}),i&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"TYT Discount:"}),e.jsxs("span",{className:"font-semibold text-amber-400",children:[i.name," (",i.discountPct,"%)"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Reinvest:"}),e.jsxs("span",{className:"font-semibold",children:[s.reinvest_percentage,"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Last Maintenance:"}),e.jsx("span",{className:"font-semibold",children:new Date(s.last_maintenance_paid).toLocaleDateString()})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-700 grid grid-cols-2 gap-2",children:[e.jsx("button",{onClick:o=>o.preventDefault(),className:"px-4 py-2 bg-amber-500/20 text-amber-400 rounded-lg font-semibold hover:bg-amber-500/30 transition-all text-sm",children:"Upgrade"}),e.jsx("button",{onClick:o=>o.preventDefault(),className:"px-4 py-2 bg-gray-700 text-gray-300 rounded-lg font-semibold hover:bg-gray-600 transition-all text-sm",children:"Pay Maint."})]})]},s.id)})}),x&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-900 rounded-xl border border-gray-700 max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Miner Settings"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Reinvest Percentage"}),e.jsx("input",{type:"range",min:"0",max:"100",value:x.reinvest_percentage,className:"w-full"}),e.jsxs("div",{className:"text-sm text-gray-400 mt-1",children:[x.reinvest_percentage,"% of rewards"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>m(null),className:"flex-1 px-4 py-2 bg-gray-700 rounded-lg font-semibold hover:bg-gray-600 transition-all",children:"Cancel"}),e.jsx("button",{onClick:()=>m(null),className:"flex-1 px-4 py-2 bg-amber-500 rounded-lg font-semibold hover:bg-amber-400 transition-all",children:"Save"})]})]})]})})]})}export{H as default};
