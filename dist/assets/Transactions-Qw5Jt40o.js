import{E as C,r as c,j as e,k as D,e as y}from"./index-Cb_Vey4A.js";import{T as l}from"./transactionService-O2XYPVPl.js";import{D as _}from"./download-DeDhYPeV.js";import{F as L}from"./filter-CbXyuDTl.js";import{E as f}from"./external-link-Dv1yQxy7.js";import{A as U}from"./arrow-down-left-ouAMLqxy.js";import{A}from"./arrow-up-right-D1jRNhcf.js";function M(){const{user:o}=C(),[j,v]=c.useState([]),[N,m]=c.useState(!0),[x,w]=c.useState(!1),[u,p]=c.useState(""),[t,h]=c.useState({limit:50,offset:0});c.useEffect(()=>{o&&T()},[o,t]);const T=async()=>{if(!o)return;m(!0);const{data:r}=await l.getUserTransactions(o.id,t);r&&v(r),m(!1)},S=async()=>{if(!o)return;const r=await l.exportTransactionsToCSV(o.id,t),s=new Blob([r],{type:"text/csv"}),a=window.URL.createObjectURL(s),d=document.createElement("a");d.href=a,d.download=`transactions_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(d),d.click(),document.body.removeChild(d),window.URL.revokeObjectURL(a)},n=(r,s)=>{h(a=>({...a,[r]:s,offset:0}))},k=()=>{h({limit:50,offset:0}),p("")},i=j.filter(r=>{if(!u)return!0;const s=u.toLowerCase();return r.description.toLowerCase().includes(s)||r.type.toLowerCase().includes(s)||r.currency.toLowerCase().includes(s)||r.tx_hash?.toLowerCase().includes(s)}),g=r=>r==="deposit"||r==="mining_reward"||r==="referral_bonus"||r==="staking_reward"?e.jsx(U,{className:"w-5 h-5 text-green-400"}):r==="withdrawal"?e.jsx(A,{className:"w-5 h-5 text-red-400"}):e.jsx(y,{className:"w-5 h-5 text-blue-400"}),b=r=>r==="deposit"||r==="mining_reward"||r==="referral_bonus"||r==="staking_reward"?"text-green-400":r==="withdrawal"||r==="maintenance_payment"?"text-red-400":"text-blue-400";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Transaction History"}),e.jsx("p",{className:"text-gray-400",children:"View and export your complete transaction history"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:S,className:"flex items-center gap-2 px-4 py-2 bg-green-500/20 text-green-400 rounded-lg hover:bg-green-500/30 transition-colors border border-green-500/50",children:[e.jsx(_,{className:"w-4 h-4"}),"Export CSV"]}),e.jsxs("button",{onClick:()=>w(!x),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors border ${x?"bg-blue-500/20 text-blue-400 border-blue-500/50":"bg-gray-800 text-gray-300 border-gray-700 hover:bg-gray-700"}`,children:[e.jsx(L,{className:"w-4 h-4"}),"Filters"]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(D,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",value:u,onChange:r=>p(r.target.value),placeholder:"Search by description, type, currency, or TX hash...",className:"w-full pl-12 pr-4 py-3 bg-gray-800 border border-gray-700 rounded-xl focus:outline-none focus:border-blue-500 transition-colors"})]}),x&&e.jsxs("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 border border-gray-700 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Filters"}),e.jsx("button",{onClick:k,className:"text-sm text-gray-400 hover:text-white transition-colors",children:"Clear All"})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Transaction Type"}),e.jsxs("select",{value:t.type||"",onChange:r=>n("type",r.target.value||void 0),className:"w-full px-4 py-2 bg-gray-900 border border-gray-700 rounded-lg focus:outline-none focus:border-blue-500",children:[e.jsx("option",{value:"",children:"All Types"}),e.jsx("option",{value:"deposit",children:"Deposit"}),e.jsx("option",{value:"withdrawal",children:"Withdrawal"}),e.jsx("option",{value:"mining_reward",children:"Mining Reward"}),e.jsx("option",{value:"maintenance_payment",children:"Maintenance"}),e.jsx("option",{value:"nft_purchase",children:"NFT Purchase"}),e.jsx("option",{value:"marketplace_buy",children:"Marketplace Buy"}),e.jsx("option",{value:"marketplace_sell",children:"Marketplace Sell"}),e.jsx("option",{value:"upgrade",children:"Upgrade"}),e.jsx("option",{value:"reinvest",children:"Reinvest"}),e.jsx("option",{value:"foundation_donation",children:"Foundation"}),e.jsx("option",{value:"referral_bonus",children:"Referral"}),e.jsx("option",{value:"staking_reward",children:"Staking"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Status"}),e.jsxs("select",{value:t.status||"",onChange:r=>n("status",r.target.value||void 0),className:"w-full px-4 py-2 bg-gray-900 border border-gray-700 rounded-lg focus:outline-none focus:border-blue-500",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"processing",children:"Processing"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"failed",children:"Failed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Currency"}),e.jsxs("select",{value:t.currency||"",onChange:r=>n("currency",r.target.value||void 0),className:"w-full px-4 py-2 bg-gray-900 border border-gray-700 rounded-lg focus:outline-none focus:border-blue-500",children:[e.jsx("option",{value:"",children:"All Currencies"}),e.jsx("option",{value:"BTC",children:"Bitcoin (BTC)"}),e.jsx("option",{value:"TYT",children:"TYT Token"}),e.jsx("option",{value:"USDT",children:"Tether (USDT)"}),e.jsx("option",{value:"USD",children:"US Dollar"}),e.jsx("option",{value:"ETH",children:"Ethereum"}),e.jsx("option",{value:"SOL",children:"Solana"}),e.jsx("option",{value:"TRX",children:"TRON"})]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Start Date"}),e.jsx("input",{type:"date",value:t.startDate?t.startDate.toISOString().split("T")[0]:"",onChange:r=>n("startDate",r.target.value?new Date(r.target.value):void 0),className:"w-full px-4 py-2 bg-gray-900 border border-gray-700 rounded-lg focus:outline-none focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"End Date"}),e.jsx("input",{type:"date",value:t.endDate?t.endDate.toISOString().split("T")[0]:"",onChange:r=>n("endDate",r.target.value?new Date(r.target.value):void 0),className:"w-full px-4 py-2 bg-gray-900 border border-gray-700 rounded-lg focus:outline-none focus:border-blue-500"})]})]})]}),e.jsx("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 border border-gray-700 rounded-xl overflow-hidden",children:N?e.jsxs("div",{className:"p-12 text-center text-gray-400",children:[e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"}),"Loading transactions..."]}):i.length===0?e.jsxs("div",{className:"p-12 text-center text-gray-400",children:[e.jsx(y,{className:"w-12 h-12 mx-auto mb-4 opacity-30"}),e.jsx("p",{className:"text-lg font-semibold mb-2",children:"No transactions found"}),e.jsx("p",{className:"text-sm",children:"Try adjusting your filters or make your first transaction!"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-900/50 border-b border-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-400 uppercase",children:"Type"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-400 uppercase",children:"Description"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-400 uppercase",children:"Amount"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-400 uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-400 uppercase",children:"Date"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-400 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-800",children:i.map(r=>{const s=l.getTransactionStatusDisplay(r.status),a=r.blockchain&&r.tx_hash?l.getBlockchainExplorerUrl(r.blockchain,r.tx_hash):null;return e.jsxs("tr",{className:"hover:bg-gray-800/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[g(r.type),e.jsx("span",{className:"font-medium",children:l.getTransactionTypeDisplay(r.type)})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-gray-300 text-sm",children:r.description})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`font-bold ${b(r.type)}`,children:l.formatAmount(r.amount,r.currency)})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold
                            ${s.color==="green"?"bg-green-500/20 text-green-400 border border-green-500/50":""}
                            ${s.color==="blue"?"bg-blue-500/20 text-blue-400 border border-blue-500/50":""}
                            ${s.color==="yellow"?"bg-yellow-500/20 text-yellow-400 border border-yellow-500/50":""}
                            ${s.color==="red"?"bg-red-500/20 text-red-400 border border-red-500/50":""}
                            ${s.color==="gray"?"bg-gray-500/20 text-gray-400 border border-gray-500/50":""}
                          `,children:s.label})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:new Date(r.created_at).toLocaleDateString()}),e.jsx("div",{className:"text-gray-400 text-xs",children:new Date(r.created_at).toLocaleTimeString()})]})}),e.jsx("td",{className:"px-6 py-4",children:a&&e.jsxs("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-blue-400 hover:text-blue-300 transition-colors text-sm",children:["View on Chain",e.jsx(f,{className:"w-3 h-3"})]})})]},r.id)})})]})}),e.jsx("div",{className:"md:hidden divide-y divide-gray-800",children:i.map(r=>{const s=l.getTransactionStatusDisplay(r.status),a=r.blockchain&&r.tx_hash?l.getBlockchainExplorerUrl(r.blockchain,r.tx_hash):null;return e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[g(r.type),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:l.getTransactionTypeDisplay(r.type)}),e.jsx("div",{className:"text-xs text-gray-400",children:new Date(r.created_at).toLocaleString()})]})]}),e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-semibold
                        ${s.color==="green"?"bg-green-500/20 text-green-400":""}
                        ${s.color==="blue"?"bg-blue-500/20 text-blue-400":""}
                        ${s.color==="yellow"?"bg-yellow-500/20 text-yellow-400":""}
                        ${s.color==="red"?"bg-red-500/20 text-red-400":""}
                      `,children:s.label})]}),e.jsx("p",{className:"text-sm text-gray-300",children:r.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`font-bold text-lg ${b(r.type)}`,children:l.formatAmount(r.amount,r.currency)}),a&&e.jsxs("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-blue-400 text-xs",children:["View",e.jsx(f,{className:"w-3 h-3"})]})]})]},r.id)})}),e.jsxs("div",{className:"bg-gray-900/50 border-t border-gray-700 px-6 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-400",children:["Showing ",i.length," transaction",i.length!==1?"s":""]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>n("offset",Math.max(0,(t.offset||0)-(t.limit||50))),disabled:(t.offset||0)===0,className:"px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-700 transition-colors",children:"Previous"}),e.jsx("button",{onClick:()=>n("offset",(t.offset||0)+(t.limit||50)),disabled:i.length<(t.limit||50),className:"px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-700 transition-colors",children:"Next"})]})]})]})})]})}export{M as default};
