import{E as I,r as n,z as c,j as e,v as Y,T as p,q as w,U as $,B as O,x as X,O as N,L as _}from"./index-Cb_Vey4A.js";const v={platform_action:{label:"Platform",icon:p,color:"blue"},social_engagement:{label:"Social",icon:X,color:"cyan"},educational:{label:"Education",icon:O,color:"purple"},community:{label:"Community",icon:$,color:"green"}};function L(){const{user:i}=I(),[u,C]=n.useState([]),[g,T]=n.useState([]),[x,f]=n.useState("all"),[h,m]=n.useState(!1),[Q,S]=n.useState(0),[A,k]=n.useState(0);n.useEffect(()=>{i&&(D(),b())},[i]);const D=async()=>{const{data:t,error:s}=await c.from("academy_quests").select("*").eq("is_active",!0).order("xp_reward",{ascending:!1});t&&C(t)},b=async()=>{if(!i)return;const{data:t}=await c.from("academy_user_quests").select("*").eq("user_id",i.id);if(t){T(t);const s=t.filter(r=>r.completed_at).reduce((r,l)=>{const d=u.find(o=>o.id===l.quest_id);return r+(d?.xp_reward||0)},0),a=t.filter(r=>r.completed_at).reduce((r,l)=>{const d=u.find(o=>o.id===l.quest_id);return r+(d?.tyt_reward||0)},0);S(s),k(a)}},E=t=>{const s=g.find(a=>a.quest_id===t.id);return s?s.completed_at?"completed":"in_progress":"available"},y=async t=>{if(i){m(!0);try{const{error:s}=await c.from("academy_user_quests").insert({user_id:i.id,quest_id:t.id,progress:{}});if(s)throw s;alert("Quest started! Complete the requirements to claim your rewards."),b()}catch(s){console.error("Quest start error:",s),alert(s.message||"Failed to start quest")}finally{m(!1)}}},P=async t=>{if(i){m(!0);try{const s=g.find(l=>l.quest_id===t.id);if(!s)return;const{error:a}=await c.from("academy_quest_completions").update({status:"completed",completed_at:new Date().toISOString(),verified_at:new Date().toISOString(),xp_claimed:t.xp_reward,tyt_claimed:t.tyt_reward}).eq("id",s.id);if(a)throw a;const{data:r}=await c.from("profiles").select("academy_xp").eq("id",i.id).single();r&&await c.from("profiles").update({academy_xp:(r.academy_xp||0)+t.xp_reward}).eq("id",i.id),alert(`Quest completed! Earned ${t.xp_reward} XP and ${t.tyt_reward} TYT!`),b()}catch(s){console.error("Quest completion error:",s),alert(s.message||"Failed to complete quest")}finally{m(!1)}}},q=t=>{t.social_url&&(window.open(t.social_url,"_blank"),y(t))},j=u.filter(t=>x==="all"?!0:t.quest_type===x);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Quests & Missions"}),e.jsx("p",{className:"text-gray-400",children:"Complete quests to earn XP and TYT rewards"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-gradient-to-br from-purple-500/20 to-purple-600/20 rounded-xl p-6 border border-purple-500/30",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-purple-500/20 rounded-lg",children:e.jsx(Y,{className:"w-6 h-6 text-purple-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:g.filter(t=>t.status==="completed").length}),e.jsx("div",{className:"text-sm text-gray-400",children:"Quests Completed"})]})]})}),e.jsx("div",{className:"bg-gradient-to-br from-blue-500/20 to-blue-600/20 rounded-xl p-6 border border-blue-500/30",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-500/20 rounded-lg",children:e.jsx(p,{className:"w-6 h-6 text-blue-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:Q.toLocaleString()}),e.jsx("div",{className:"text-sm text-gray-400",children:"Total XP Earned"})]})]})}),e.jsx("div",{className:"bg-gradient-to-br from-[#D2A44C]/20 to-yellow-600/20 rounded-xl p-6 border border-[#D2A44C]/30",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-[#D2A44C]/20 rounded-lg",children:e.jsx(w,{className:"w-6 h-6 text-[#D2A44C]"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:A.toFixed(2)}),e.jsx("div",{className:"text-sm text-gray-400",children:"TYT Earned"})]})]})})]}),e.jsxs("div",{className:"flex gap-3 overflow-x-auto pb-2",children:[e.jsx("button",{onClick:()=>f("all"),className:`px-4 py-2 rounded-lg whitespace-nowrap transition-all ${x==="all"?"bg-[#D2A44C] text-white":"bg-gray-800 text-gray-400 hover:bg-gray-700"}`,children:"All Quests"}),Object.entries(v).map(([t,s])=>{const a=s.icon;return e.jsxs("button",{onClick:()=>f(t),className:`flex items-center gap-2 px-4 py-2 rounded-lg whitespace-nowrap transition-all ${x===t?"bg-[#D2A44C] text-white":"bg-gray-800 text-gray-400 hover:bg-gray-700"}`,children:[e.jsx(a,{className:"w-4 h-4"}),s.label]},t)})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:j.map(t=>{const s=E(t),a=v[t.quest_type],r=a.icon,l=s==="completed",d=s==="in_progress",o=s==="locked";return e.jsx("div",{className:`bg-gradient-to-br from-gray-800/50 to-gray-900/50 rounded-xl p-6 border transition-all ${l?"border-green-500/50 bg-green-500/5":o?"border-gray-700/30 opacity-60":"border-gray-700/50 hover:border-[#D2A44C]/50"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${l?"bg-green-500/20":o?"bg-gray-700/20":"bg-[#D2A44C]/20"}`,children:l?e.jsx(N,{className:"w-6 h-6 text-green-400"}):o?e.jsx(_,{className:"w-6 h-6 text-gray-400"}):e.jsx(r,{className:"w-6 h-6 text-[#D2A44C]"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-1",children:t.title}),e.jsx("span",{className:`text-xs px-2 py-1 rounded ${a.color==="blue"?"bg-blue-500/20 text-blue-400":a.color==="cyan"?"bg-cyan-500/20 text-cyan-400":a.color==="purple"?"bg-purple-500/20 text-purple-400":"bg-green-500/20 text-green-400"}`,children:a.label})]}),t.is_repeatable&&e.jsx("span",{className:"text-xs px-2 py-1 bg-yellow-500/20 text-yellow-400 rounded",children:"Repeatable"})]}),e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:t.description}),e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{className:"w-4 h-4 text-blue-400"}),e.jsxs("span",{className:"text-sm text-white font-medium",children:["+",t.xp_reward," XP"]})]}),t.tyt_reward>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-4 h-4 text-[#D2A44C]"}),e.jsxs("span",{className:"text-sm text-white font-medium",children:["+",t.tyt_reward," TYT"]})]})]}),l?e.jsxs("div",{className:"flex items-center gap-2 text-green-400",children:[e.jsx(N,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Completed!"})]}):o?e.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[e.jsx(_,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm",children:"Complete prerequisites to unlock"})]}):d?e.jsx("button",{onClick:()=>P(t),disabled:h,className:"px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-all disabled:opacity-50",children:"Claim Rewards"}):t.quest_type==="social_engagement"?e.jsx("button",{onClick:()=>q(t),disabled:h,className:"px-4 py-2 bg-[#D2A44C] text-white rounded-lg hover:bg-yellow-600 transition-all disabled:opacity-50",children:"Complete Quest"}):e.jsx("button",{onClick:()=>y(t),disabled:h,className:"px-4 py-2 bg-[#D2A44C] text-white rounded-lg hover:bg-yellow-600 transition-all disabled:opacity-50",children:"Start Quest"})]})]})},t.id)})}),j.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(p,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"No Quests Available"}),e.jsx("p",{className:"text-gray-400",children:"Check back later for new quests!"})]})]})}export{L as default};
