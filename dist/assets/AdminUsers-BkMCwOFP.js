import{c as K,E as Y,r as l,z as o,j as e,U as u,C as y,S as A,n as p,k as E,_ as f}from"./index-Cb_Vey4A.js";import{R as N}from"./refresh-cw-DbeEGu-Y.js";import{D as I}from"./download-DeDhYPeV.js";import{E as R}from"./eye-Cg-JXnRD.js";const z=K("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);function O(){const{user:P}=Y(),[r,w]=l.useState([]),[_,b]=l.useState(!0),[x,k]=l.useState(""),[m,C]=l.useState("all"),[h,S]=l.useState("all"),[t,L]=l.useState(null),[U,g]=l.useState(!1);l.useEffect(()=>{d()},[]);const d=async()=>{b(!0);try{const{data:s}=await o.from("profiles").select("*").order("created_at",{ascending:!1});if(s){const c=await Promise.all(s.map(async a=>{const{data:n}=await o.auth.admin.getUserById(a.id);return{...a,email:n?.user?.email||"N/A",last_seen:n?.user?.last_sign_in_at||null}}));w(c)}}catch(s){console.error("Error loading users:",s)}finally{b(!1)}},j=async(s,c)=>{try{await o.from("profiles").update({is_active:!c}).eq("id",s),await d()}catch(a){console.error("Error toggling user status:",a)}},D=async(s,c,a)=>{try{await o.from("profiles").update({kyc_level:c,kyc_status:a}).eq("id",s),await d()}catch(n){console.error("Error updating KYC:",n)}},v=r.filter(s=>{const c=s.email?.toLowerCase().includes(x.toLowerCase())||s.full_name?.toLowerCase().includes(x.toLowerCase()),a=m==="all"||s.kyc_level===parseInt(m),n=h==="all"||(h==="active"?s.is_active:!s.is_active);return c&&a&&n}),i={total:r.length,active:r.filter(s=>s.is_active).length,kyc0:r.filter(s=>s.kyc_level===0).length,kyc1:r.filter(s=>s.kyc_level===1).length,kyc2:r.filter(s=>s.kyc_level===2).length,kyc3:r.filter(s=>s.kyc_level===3).length};return _?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(N,{className:"w-6 h-6 text-blue-400 animate-spin"}),e.jsx("span",{className:"text-gray-400",children:"Loading users..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"User Management"}),e.jsx("p",{className:"text-gray-400",children:"Manage user accounts, KYC verification, and access control"})]}),e.jsxs("button",{onClick:d,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg flex items-center gap-2 transition-colors",children:[e.jsx(N,{className:"w-4 h-4"}),"Refresh"]})]}),e.jsxs("div",{className:"grid md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-500/10 to-blue-600/10 border border-blue-500/30 rounded-xl p-6",children:[e.jsx(u,{className:"w-8 h-8 text-blue-400 mb-3"}),e.jsx("div",{className:"text-3xl font-bold mb-1",children:i.total}),e.jsx("div",{className:"text-sm text-gray-400",children:"Total Users"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-500/10 to-green-600/10 border border-green-500/30 rounded-xl p-6",children:[e.jsx(y,{className:"w-8 h-8 text-green-400 mb-3"}),e.jsx("div",{className:"text-3xl font-bold mb-1",children:i.active}),e.jsx("div",{className:"text-sm text-gray-400",children:"Active Users"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-amber-500/10 to-amber-600/10 border border-amber-500/30 rounded-xl p-6",children:[e.jsx(A,{className:"w-8 h-8 text-amber-400 mb-3"}),e.jsx("div",{className:"text-3xl font-bold mb-1",children:i.kyc2+i.kyc3}),e.jsx("div",{className:"text-sm text-gray-400",children:"Verified (KYC 2-3)"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-500/10 to-purple-600/10 border border-purple-500/30 rounded-xl p-6",children:[e.jsx(p,{className:"w-8 h-8 text-purple-400 mb-3"}),e.jsx("div",{className:"text-3xl font-bold mb-1",children:i.kyc0+i.kyc1}),e.jsx("div",{className:"text-sm text-gray-400",children:"Pending (KYC 0-1)"})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 border border-gray-700 rounded-xl p-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(E,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",value:x,onChange:s=>k(s.target.value),placeholder:"Search by email or name...",className:"w-full pl-10 pr-4 py-3 bg-gray-900 border border-gray-700 rounded-lg text-white focus:outline-none focus:border-blue-500 transition-colors"})]}),e.jsxs("select",{value:m,onChange:s=>C(s.target.value),className:"px-4 py-3 bg-gray-900 border border-gray-700 rounded-lg text-white focus:outline-none focus:border-blue-500 transition-colors",children:[e.jsx("option",{value:"all",children:"All KYC Levels"}),e.jsx("option",{value:"0",children:"KYC Level 0"}),e.jsx("option",{value:"1",children:"KYC Level 1"}),e.jsx("option",{value:"2",children:"KYC Level 2"}),e.jsx("option",{value:"3",children:"KYC Level 3"})]}),e.jsxs("select",{value:h,onChange:s=>S(s.target.value),className:"px-4 py-3 bg-gray-900 border border-gray-700 rounded-lg text-white focus:outline-none focus:border-blue-500 transition-colors",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active Only"}),e.jsx("option",{value:"inactive",children:"Inactive Only"})]}),e.jsxs("button",{className:"px-4 py-3 bg-green-500 hover:bg-green-600 text-white rounded-lg flex items-center gap-2 transition-colors",children:[e.jsx(I,{className:"w-5 h-5"}),"Export"]})]}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-400",children:"User"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-400",children:"Email"}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold text-gray-400",children:"KYC Level"}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold text-gray-400",children:"Status"}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold text-gray-400",children:"Rank"}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold text-gray-400",children:"Joined"}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold text-gray-400",children:"Actions"})]})}),e.jsx("tbody",{children:v.map(s=>e.jsxs("tr",{className:"border-b border-gray-800 hover:bg-gray-800/50 transition-colors",children:[e.jsx("td",{className:"py-4 px-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white font-bold",children:s.full_name?.charAt(0)||s.email.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:s.full_name||"No Name"}),e.jsxs("div",{className:"text-xs text-gray-500",children:[s.id.slice(0,8),"..."]})]})]})}),e.jsx("td",{className:"py-4 px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm",children:s.email})]})}),e.jsx("td",{className:"py-4 px-4 text-center",children:e.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold ${s.kyc_level===0?"bg-gray-700 text-gray-300":s.kyc_level===1?"bg-blue-500/20 text-blue-400 border border-blue-500/50":s.kyc_level===2?"bg-green-500/20 text-green-400 border border-green-500/50":"bg-amber-500/20 text-amber-400 border border-amber-500/50"}`,children:["Level ",s.kyc_level]})}),e.jsx("td",{className:"py-4 px-4 text-center",children:s.is_active?e.jsx(y,{className:"w-5 h-5 text-green-400 mx-auto"}):e.jsx(f,{className:"w-5 h-5 text-red-400 mx-auto"})}),e.jsxs("td",{className:"py-4 px-4 text-center",children:[e.jsx("div",{className:"text-sm capitalize",children:s.rank}),e.jsxs("div",{className:"text-xs text-gray-500",children:[s.rank_score," XP"]})]}),e.jsxs("td",{className:"py-4 px-4 text-center",children:[e.jsx("div",{className:"text-sm",children:new Date(s.created_at).toLocaleDateString()}),s.last_seen&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Last: ",new Date(s.last_seen).toLocaleDateString()]})]}),e.jsx("td",{className:"py-4 px-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:()=>{L(s),g(!0)},className:"p-2 bg-blue-500/20 text-blue-400 rounded-lg hover:bg-blue-500/30 transition-colors",title:"View Details",children:e.jsx(R,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>j(s.id,s.is_active),className:`p-2 rounded-lg transition-colors ${s.is_active?"bg-red-500/20 text-red-400 hover:bg-red-500/30":"bg-green-500/20 text-green-400 hover:bg-green-500/30"}`,title:s.is_active?"Deactivate":"Activate",children:e.jsx(z,{className:"w-4 h-4"})})]})})]},s.id))})]}),v.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(u,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"No users found matching your filters."})]})]})]}),U&&t&&e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-900 rounded-xl border border-gray-700 max-w-2xl w-full p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-2xl font-bold",children:"User Details"}),e.jsx("button",{onClick:()=>g(!1),className:"text-gray-400 hover:text-white",children:e.jsx(f,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Full Name"}),e.jsx("div",{className:"font-semibold",children:t.full_name||"Not set"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Email"}),e.jsx("div",{className:"font-semibold",children:t.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-400",children:"User ID"}),e.jsx("div",{className:"font-mono text-sm",children:t.id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Owl Rank"}),e.jsxs("div",{className:"font-semibold capitalize",children:[t.rank," (",t.rank_score," XP)"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-400",children:"KYC Status"}),e.jsxs("div",{className:"font-semibold",children:["Level ",t.kyc_level," - ",t.kyc_status]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Account Status"}),e.jsx("div",{className:"font-semibold",children:t.is_active?"✅ Active":"❌ Inactive"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Joined"}),e.jsx("div",{className:"font-semibold",children:new Date(t.created_at).toLocaleString()})]}),t.last_seen&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Last Seen"}),e.jsx("div",{className:"font-semibold",children:new Date(t.last_seen).toLocaleString()})]})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-700",children:[e.jsx("label",{className:"text-sm text-gray-400 mb-2 block",children:"Update KYC Level"}),e.jsx("div",{className:"flex gap-2",children:[0,1,2,3].map(s=>e.jsxs("button",{onClick:()=>D(t.id,s,"approved"),className:`px-4 py-2 rounded-lg font-semibold transition-colors ${t.kyc_level===s?"bg-blue-500 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:["Level ",s]},s))})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>g(!1),className:"flex-1 px-4 py-3 bg-gray-700 rounded-lg font-semibold hover:bg-gray-600 transition-colors",children:"Close"}),e.jsx("button",{onClick:()=>j(t.id,t.is_active),className:`flex-1 px-4 py-3 rounded-lg font-semibold transition-colors ${t.is_active?"bg-red-500 hover:bg-red-600":"bg-green-500 hover:bg-green-600"}`,children:t.is_active?"Deactivate User":"Activate User"})]})]})})]})}export{O as default};
