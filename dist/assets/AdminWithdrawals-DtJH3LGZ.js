import{r as i,ak as v,z as p,j as e,C as j,k as w,_ as C}from"./index-Cb_Vey4A.js";import{C as k}from"./clock-ClFQAG9n.js";import{E as S}from"./external-link-Dv1yQxy7.js";function L(){const[r,m]=i.useState([]),[g,x]=i.useState(!0),[t,n]=i.useState("pending"),[o,b]=i.useState(""),{showToast:l}=v();i.useEffect(()=>{d()},[t]);const d=async()=>{try{x(!0);let s=p.from("withdrawal_requests").select(`
          *,
          user:users(email)
        `).order("requested_at",{ascending:!1});t!=="all"&&(s=s.eq("status",t));const{data:a,error:c}=await s;if(c)throw c;m(a?.map(f=>({...f,user_email:f.user?.email}))||[])}catch(s){console.error("Error fetching withdrawals:",s),l("Failed to load withdrawals","error")}finally{x(!1)}},y=async s=>{try{const{error:a}=await p.from("withdrawal_requests").update({status:"processing",processed_at:new Date().toISOString()}).eq("id",s);if(a)throw a;l("Withdrawal approved and processing","success"),d()}catch(a){console.error("Error approving withdrawal:",a),l("Failed to approve withdrawal","error")}},N=async(s,a)=>{try{const{error:c}=await p.from("withdrawal_requests").update({status:"rejected",rejection_reason:a,processed_at:new Date().toISOString()}).eq("id",s);if(c)throw c;l("Withdrawal rejected","success"),d()}catch(c){console.error("Error rejecting withdrawal:",c),l("Failed to reject withdrawal","error")}},h=r.filter(s=>o===""||s.user_email?.toLowerCase().includes(o.toLowerCase())||s.to_address.toLowerCase().includes(o.toLowerCase())),u={pending:r.filter(s=>s.status==="pending").length,processing:r.filter(s=>s.status==="processing").length,totalAmount:r.filter(s=>s.status==="pending").reduce((s,a)=>s+a.amount,0)};return e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold mb-2",children:"Withdrawal Management"}),e.jsx("p",{className:"text-gray-400",children:"Review and approve user withdrawal requests"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-gradient-to-br from-yellow-500/10 to-orange-500/10 border border-yellow-500/30 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-gray-400",children:"Pending Approval"}),e.jsx(k,{className:"w-5 h-5 text-yellow-400"})]}),e.jsx("div",{className:"text-3xl font-bold text-yellow-400",children:u.pending})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-500/10 to-cyan-500/10 border border-blue-500/30 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-gray-400",children:"Processing"}),e.jsx(j,{className:"w-5 h-5 text-blue-400"})]}),e.jsx("div",{className:"text-3xl font-bold text-blue-400",children:u.processing})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-500/10 to-emerald-500/10 border border-green-500/30 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-gray-400",children:"Total Pending Value"}),e.jsx("span",{className:"text-xs text-gray-500",children:"USD"})]}),e.jsxs("div",{className:"text-3xl font-bold text-green-400",children:["$",u.totalAmount.toLocaleString()]})]})]}),e.jsx("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl p-6 border border-gray-700 mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(w,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"text",placeholder:"Search by email or address...",value:o,onChange:s=>b(s.target.value),className:"w-full pl-10 pr-4 py-2 bg-gray-900 border border-gray-700 rounded-lg focus:outline-none focus:border-amber-500"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>n("all"),className:`px-4 py-2 rounded-lg transition-colors ${t==="all"?"bg-amber-500 text-black font-bold":"bg-gray-800 hover:bg-gray-700"}`,children:"All"}),e.jsx("button",{onClick:()=>n("pending"),className:`px-4 py-2 rounded-lg transition-colors ${t==="pending"?"bg-yellow-500 text-black font-bold":"bg-gray-800 hover:bg-gray-700"}`,children:"Pending"}),e.jsx("button",{onClick:()=>n("processing"),className:`px-4 py-2 rounded-lg transition-colors ${t==="processing"?"bg-blue-500 text-black font-bold":"bg-gray-800 hover:bg-gray-700"}`,children:"Processing"})]})]})}),e.jsx("div",{className:"space-y-4",children:g?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-amber-500 border-t-transparent rounded-full mx-auto"}),e.jsx("p",{className:"text-gray-400 mt-4",children:"Loading withdrawals..."})]}):h.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-400",children:"No withdrawals found"})}):h.map(s=>e.jsx(_,{withdrawal:s,onApprove:y,onReject:N},s.id))})]})}function _({withdrawal:r,onApprove:m,onReject:g}){const[x,t]=i.useState(!1),[n,o]=i.useState(""),l=(d=>{switch(d){case"pending":return"yellow";case"processing":return"blue";case"completed":return"green";case"rejected":return"red";default:return"gray"}})(r.status);return e.jsxs("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl p-6 border border-gray-700",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:`px-3 py-1 bg-${l}-500/20 border border-${l}-500/50 rounded-full text-sm font-semibold text-${l}-400`,children:r.status.toUpperCase()}),e.jsx("div",{className:"px-3 py-1 bg-purple-500/20 border border-purple-500/50 rounded-full text-sm text-purple-400",children:r.kyc_tier})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"User"}),e.jsx("p",{className:"font-semibold",children:r.user_email||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Amount"}),e.jsxs("p",{className:"font-semibold text-green-400",children:[r.amount," ",r.currency]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Destination Address"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-mono text-sm break-all",children:r.to_address}),e.jsx("a",{href:`https://blockchain.com/address/${r.to_address}`,target:"_blank",rel:"noopener noreferrer",className:"text-amber-400 hover:text-amber-300",children:e.jsx(S,{size:16})})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Requested"}),e.jsx("p",{className:"text-sm",children:new Date(r.requested_at).toLocaleString()})]})]})]}),r.status==="pending"&&e.jsxs("div",{className:"flex flex-col gap-2 md:w-40",children:[e.jsxs("button",{onClick:()=>m(r.id),className:"flex items-center justify-center gap-2 px-4 py-2 bg-green-500 hover:bg-green-600 text-white font-bold rounded-lg transition-colors",children:[e.jsx(j,{size:18}),"Approve"]}),e.jsxs("button",{onClick:()=>t(!0),className:"flex items-center justify-center gap-2 px-4 py-2 bg-red-500 hover:bg-red-600 text-white font-bold rounded-lg transition-colors",children:[e.jsx(C,{size:18}),"Reject"]})]})]}),x&&e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl p-6 border border-gray-700 max-w-md w-full",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Reject Withdrawal"}),e.jsx("p",{className:"text-gray-400 mb-4",children:"Please provide a reason for rejection:"}),e.jsx("textarea",{value:n,onChange:d=>o(d.target.value),className:"w-full px-4 py-2 bg-gray-900 border border-gray-700 rounded-lg focus:outline-none focus:border-amber-500 mb-4",rows:4,placeholder:"e.g., Insufficient KYC verification, Suspicious activity, etc."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{g(r.id,n),t(!1),o("")},disabled:!n,className:"flex-1 px-4 py-2 bg-red-500 hover:bg-red-600 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold rounded-lg transition-colors",children:"Confirm Rejection"}),e.jsx("button",{onClick:()=>{t(!1),o("")},className:"flex-1 px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white font-bold rounded-lg transition-colors",children:"Cancel"})]})]})})]})}export{L as default};
