import{c as $,E as R,r as n,z as d,j as e,H as j,L as _,U as I,Y as H,e as q,a as G,f as M,S as z,q as B}from"./index-Cb_Vey4A.js";import{C as W}from"./calendar-DfOGD8DU.js";const V=$("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);function O(){const{user:i}=R(),[m,w]=n.useState([]),[c,S]=n.useState([]),[t,h]=n.useState(null),[l,f]=n.useState(""),[o,p]=n.useState(30),[u,T]=n.useState(0),[y,N]=n.useState(!1),[Y,v]=n.useState(!1),[L,C]=n.useState(!0);n.useEffect(()=>{i&&g()},[i]);const g=async()=>{if(i)try{const[s,a,r]=await Promise.all([d.from("charity_staking_pools").select("*").eq("is_active",!0).order("base_apy"),d.from("charity_stakes").select("*").eq("user_id",i.id).in("status",["active","completed"]),d.from("custodial_wallets").select("balance").eq("user_id",i.id).eq("asset","TYT").maybeSingle()]);s.data&&w(s.data),a.data&&S(a.data),r.data&&T(parseFloat(r.data.balance))}catch(s){console.error("Error loading charity staking data:",s)}finally{C(!1)}},F=async()=>{if(!i||!t||!l)return;const s=parseFloat(l);if(!(s<t.min_stake_amount||s>u)){N(!0);try{const{data:a,error:r}=await d.rpc("create_charity_stake",{p_user_id:i.id,p_pool_id:t.id,p_stake_amount:s,p_lock_days:o});if(r)throw r;f(""),await g(),h(null)}catch(a){console.error("Error staking:",a),alert(a.message||"Failed to stake")}finally{N(!1)}}},P=async s=>{if(i){v(!0);try{const{error:a}=await d.rpc("withdraw_charity_stake",{p_stake_id:s,p_user_id:i.id});if(a)throw a;await g()}catch(a){console.error("Error unstaking:",a),alert(a.message||"Failed to unstake")}finally{v(!1)}}},A=s=>s.includes("Hope")?e.jsx(G,{className:"w-6 h-6"}):s.includes("Life")?e.jsx(j,{className:"w-6 h-6"}):s.includes("Legacy")?e.jsx(M,{className:"w-6 h-6"}):s.includes("Hero")?e.jsx(z,{className:"w-6 h-6"}):e.jsx(B,{className:"w-6 h-6"}),U=s=>s.includes("Hope")?"from-blue-500 to-cyan-500":s.includes("Life")?"from-pink-500 to-rose-500":s.includes("Legacy")?"from-purple-500 to-indigo-500":s.includes("Hero")?"from-gold-500 to-amber-500":"from-green-500 to-emerald-500",k=c.filter(s=>s.status==="active").reduce((s,a)=>s+a.stake_amount,0),D=c.reduce((s,a)=>s+a.total_donated,0),E=m.reduce((s,a)=>s+a.total_donated,0);return L?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"w-8 h-8 border-4 border-gold-400 border-t-transparent rounded-full animate-spin"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold mb-2 flex items-center gap-3",children:[e.jsx(j,{className:"w-8 h-8 text-pink-400"}),"Charity Staking"]}),e.jsx("p",{className:"text-gray-400",children:"Stake TYT and support children with brain cancer"})]})}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-pink-900/30 to-rose-900/30 rounded-xl p-6 border border-pink-500/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-gray-400",children:"Your Active Stakes"}),e.jsx(_,{className:"w-5 h-5 text-pink-400"})]}),e.jsxs("div",{className:"text-3xl font-bold text-white mb-1",children:[k.toLocaleString()," TYT"]}),e.jsxs("div",{className:"text-sm text-gray-400",children:["$",(k*.15).toLocaleString()," USD"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-900/30 to-indigo-900/30 rounded-xl p-6 border border-purple-500/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-gray-400",children:"Total Donated"}),e.jsx(j,{className:"w-5 h-5 text-purple-400"})]}),e.jsxs("div",{className:"text-3xl font-bold text-white mb-1",children:[D.toLocaleString()," TYT"]}),e.jsx("div",{className:"text-sm text-gray-400",children:"To Foundation Research"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-900/30 to-cyan-900/30 rounded-xl p-6 border border-blue-500/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-gray-400",children:"Global Impact"}),e.jsx(I,{className:"w-5 h-5 text-blue-400"})]}),e.jsxs("div",{className:"text-3xl font-bold text-white mb-1",children:["$",(E*.15).toLocaleString()]}),e.jsx("div",{className:"text-sm text-gray-400",children:"Raised for Children"})]})]}),e.jsx("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(H,{className:"w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-gray-300",children:[e.jsx("p",{className:"font-semibold text-white mb-2",children:"How Charity Staking Works"}),e.jsxs("ul",{className:"space-y-1 text-xs",children:[e.jsx("li",{children:"✓ Lock your TYT tokens for a chosen period"}),e.jsx("li",{children:"✓ Earn rewards based on APY (5% - 40%)"}),e.jsx("li",{children:"✓ 100% of rewards automatically go to TYT Children's Brain Cancer Foundation"}),e.jsx("li",{children:"✓ Get your principal back after lock period"}),e.jsx("li",{children:"✓ Track your impact on children's lives"})]})]})]})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Available Charity Pools"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:m.map(s=>{const a=U(s.pool_name),r=A(s.pool_name),x=s.base_apy+s.bonus_apy,b=s.pool_cap?s.total_staked/s.pool_cap*100:0;return e.jsxs("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl border border-gray-700 overflow-hidden hover:border-gold-500/50 transition-all",children:[e.jsx("div",{className:`h-2 bg-gradient-to-r ${a}`}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-3 bg-gradient-to-br ${a} rounded-xl`,children:r}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg",children:s.pool_name}),e.jsxs("p",{className:"text-xs text-gray-400",children:[s.min_lock_days," - ",s.max_lock_days," days"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-400",children:[x,"%"]}),e.jsx("div",{className:"text-xs text-gray-400",children:"APY"})]})]}),e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:s.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Min Stake"}),e.jsxs("div",{className:"font-bold",children:[s.min_stake_amount," TYT"]})]}),e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Total Donated"}),e.jsxs("div",{className:"font-bold text-pink-400",children:[s.total_donated.toLocaleString()," TYT"]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs mb-1",children:[e.jsx("span",{className:"text-gray-400",children:"Pool Utilization"}),e.jsxs("span",{className:"text-gray-300",children:[s.unique_stakers_count," stakers"]})]}),e.jsx("div",{className:"h-2 bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full bg-gradient-to-r ${a} transition-all`,style:{width:`${Math.min(b,100)}%`}})})]}),e.jsx("button",{onClick:()=>{h(s),p(s.min_lock_days)},className:"w-full py-3 bg-gradient-to-r from-pink-500 to-purple-500 rounded-lg font-semibold hover:from-pink-600 hover:to-purple-600 transition-all",children:"Stake in This Pool"})]})]},s.id)})})]}),c.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Your Stakes"}),e.jsx("div",{className:"space-y-4",children:c.map(s=>{const a=m.find(b=>b.id===s.pool_id),r=new Date(s.unlock_at)>new Date,x=Math.ceil((new Date(s.unlock_at).getTime()-Date.now())/(1e3*60*60*24));return e.jsxs("div",{className:"bg-gray-800/50 rounded-xl p-6 border border-gray-700",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg mb-1",children:a?.pool_name}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(W,{className:"w-4 h-4"}),s.lock_days," days"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(q,{className:"w-4 h-4"}),s.apy,"% APY"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold",children:[s.stake_amount.toLocaleString()," TYT"]}),e.jsx("div",{className:"text-sm text-gray-400",children:"Staked Amount"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-gray-900/50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Rewards Earned"}),e.jsxs("div",{className:"font-bold text-green-400",children:[s.total_rewards_earned.toFixed(2)," TYT"]})]}),e.jsxs("div",{className:"bg-gray-900/50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Donated"}),e.jsxs("div",{className:"font-bold text-pink-400",children:[s.total_donated.toFixed(2)," TYT"]})]}),e.jsxs("div",{className:"bg-gray-900/50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Status"}),e.jsx("div",{className:`font-bold ${r?"text-yellow-400":"text-green-400"}`,children:r?`${x}d left`:"Unlocked"})]})]}),s.status==="active"&&e.jsx("button",{onClick:()=>P(s.id),disabled:r||Y,className:`w-full py-3 rounded-lg font-semibold transition-all ${r?"bg-gray-700 text-gray-500 cursor-not-allowed":"bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600"}`,children:r?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx(_,{className:"w-5 h-5"}),"Locked for ",x," days"]}):e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx(V,{className:"w-5 h-5"}),"Withdraw Stake"]})})]},s.id)})})]}),t&&e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl border border-gold-500 max-w-2xl w-full p-6",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-4",children:["Stake in ",t.pool_name]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Stake Amount (TYT)"}),e.jsx("input",{type:"number",value:l,onChange:s=>f(s.target.value),placeholder:`Min: ${t.min_stake_amount}`,className:"w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg"}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["Available: ",u.toLocaleString()," TYT"]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:["Lock Period: ",o," days"]}),e.jsx("input",{type:"range",min:t.min_lock_days,max:t.max_lock_days,value:o,onChange:s=>p(parseInt(s.target.value)),className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-400",children:[e.jsxs("span",{children:[t.min_lock_days," days"]}),e.jsxs("span",{children:[t.max_lock_days," days"]})]})]}),l&&parseFloat(l)>0&&e.jsx("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-4",children:e.jsxs("div",{className:"text-sm space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Estimated Rewards:"}),e.jsxs("span",{className:"font-bold text-green-400",children:[(parseFloat(l)*(t.base_apy+t.bonus_apy)*o/365/100).toFixed(2)," ","TYT"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Goes to Foundation:"}),e.jsx("span",{className:"font-bold text-pink-400",children:"100%"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"You Get Back:"}),e.jsxs("span",{className:"font-bold",children:[l," TYT"]})]})]})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>h(null),className:"flex-1 py-3 bg-gray-700 rounded-lg font-semibold hover:bg-gray-600 transition-all",children:"Cancel"}),e.jsx("button",{onClick:F,disabled:y||!l||parseFloat(l)<t.min_stake_amount||parseFloat(l)>u,className:"flex-1 py-3 bg-gradient-to-r from-pink-500 to-purple-500 rounded-lg font-semibold hover:from-pink-600 hover:to-purple-600 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:y?"Staking...":"Confirm Stake"})]})]})})]})}export{O as default};
