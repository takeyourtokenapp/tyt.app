import{c as Q,j as e,L as xe,E as K,r as a,A as G,W as J,e as fe,z as U,O as V,Y as de,S as me,d as ve,k as we,_ as Se,Z as ke}from"./index-Cb_Vey4A.js";import{a as je,b as se,c as Te,d as Fe,e as ye}from"./useAPI-D50lHb9i.js";import{E as ge}from"./eye-Cg-JXnRD.js";import{R as Ce}from"./refresh-cw-DbeEGu-Y.js";import{A as le}from"./arrow-down-left-ouAMLqxy.js";import{L as q}from"./loader-2-CvgjdlF_.js";import{C as _e}from"./copy-Dce-p0Na.js";import{E as Ae}from"./external-link-Dv1yQxy7.js";import{A as ee}from"./arrow-up-right-D1jRNhcf.js";import{C as De}from"./clock-ClFQAG9n.js";import{D as Ee}from"./download-DeDhYPeV.js";const ie=Q("ArrowRightLeft",[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]]);const ze=Q("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);const ue=Q("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);const ne=Q("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);const oe=Q("Network",[["rect",{x:"16",y:"16",width:"6",height:"6",rx:"1",key:"4q2zg0"}],["rect",{x:"2",y:"16",width:"6",height:"6",rx:"1",key:"8cvhb9"}],["rect",{x:"9",y:"2",width:"6",height:"6",rx:"1",key:"1egb70"}],["path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3",key:"1jsf9p"}],["path",{d:"M12 12V8",key:"2874zd"}]]);const Le=Q("QrCode",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]);function Be({wallet:n,usdPrice:m,onSelect:h}){const d=parseFloat(n.balance)*m;return e.jsxs("div",{onClick:h,className:"bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl p-6 border border-gray-700 hover:border-gold-500/50 transition-all cursor-pointer",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-gold-500/20 to-amber-500/20 flex items-center justify-center text-xl font-bold text-gold-400",children:n.asset[0]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-lg",children:n.asset}),e.jsx("div",{className:"text-xs text-gray-500",children:"Available"})]})]})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:parseFloat(n.balance).toFixed(n.asset==="BTC"?8:2)}),e.jsxs("div",{className:"text-sm text-gray-400",children:["â‰ˆ $",d.toFixed(2)," USD"]}),parseFloat(n.locked_balance)>0&&e.jsxs("div",{className:"text-xs text-gold-400 mt-2 flex items-center gap-1",children:[e.jsx(xe,{size:12}),"Locked: ",parseFloat(n.locked_balance).toFixed(n.asset==="BTC"?8:2)]})]})]})}const he={BTC:95e3,ETH:3500,SOL:140,TRX:.15,XRP:2.5,TON:5.5,TYT:.05,USDT:1,USDC:1,DAI:1};function Pe({onSelectAsset:n,compact:m=!1}){const{user:h}=K(),[d,T]=a.useState(!1),[C,t]=a.useState("balance"),{data:x,isLoading:c,error:g,refetch:o}=je(h?.id),{data:f,isLoading:w}=se(h?.id),j=a.useMemo(()=>x?x.reduce((b,v)=>b+v.usd_value,0):0,[x]),D=a.useMemo(()=>{if(!x)return[];const b=[...x];return C==="balance"?b.sort((v,_)=>_.usd_value-v.usd_value):b.sort((v,_)=>v.currency.localeCompare(_.currency)),b},[x,C]),z=a.useMemo(()=>x?x.reduce((b,v)=>{const _=he[v.currency]||0;return b+v.locked_balance*_},0):0,[x]),N=()=>{o()};return g?e.jsx("div",{className:"bg-gradient-to-br from-red-900/20 to-red-800/20 rounded-xl p-8 border border-red-700/50",children:e.jsxs("div",{className:"flex items-center gap-3 text-red-400",children:[e.jsx(G,{size:24}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Failed to load balances"}),e.jsx("div",{className:"text-sm text-red-300",children:"Please try again later"})]})]})}):m?e.jsxs("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl p-6 border border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"text-gold-400",size:20}),e.jsx("h3",{className:"text-lg font-bold text-white",children:"Total Balance"})]}),e.jsx("button",{onClick:()=>T(!d),className:"text-gray-400 hover:text-white transition-colors",children:d?e.jsx(ue,{size:18}):e.jsx(ge,{size:18})})]}),e.jsx("div",{className:"text-3xl font-bold text-white mb-2",children:d?"â€¢â€¢â€¢â€¢â€¢â€¢":`$${j.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}),!d&&z>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-400",children:[e.jsx(xe,{size:14}),e.jsxs("span",{children:["Locked: $",z.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl p-6 border border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-gold-500/20 to-amber-500/20 flex items-center justify-center",children:e.jsx(J,{className:"text-gold-400",size:24})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Portfolio Value"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Total balance across all assets"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:N,disabled:c,className:"p-2 rounded-lg bg-gray-700 hover:bg-gray-600 transition-colors disabled:opacity-50",title:"Refresh balances",children:e.jsx(Ce,{size:18,className:c?"animate-spin":""})}),e.jsx("button",{onClick:()=>T(!d),className:"p-2 rounded-lg bg-gray-700 hover:bg-gray-600 transition-colors",title:d?"Show balances":"Hide balances",children:d?e.jsx(ue,{size:18}):e.jsx(ge,{size:18})})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"text-4xl font-bold text-white mb-2",children:d?"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢":`$${j.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}),!d&&e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-400",children:[e.jsx(fe,{size:16}),e.jsxs("span",{children:["Available: $",(j-z).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),z>0&&e.jsxs("div",{className:"flex items-center gap-2 text-gold-400",children:[e.jsx(xe,{size:16}),e.jsxs("span",{children:["Locked: $",z.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 pt-4 border-t border-gray-700",children:[e.jsx("div",{className:"text-sm text-gray-400",children:"Sort by:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>t("balance"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${C==="balance"?"bg-gold-500/20 text-gold-400 border border-gold-500/50":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"Balance"}),e.jsx("button",{onClick:()=>t("name"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${C==="name"?"bg-gold-500/20 text-gold-400 border border-gold-500/50":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"Name"})]})]})]}),c||w?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3,4,5,6].map(b=>e.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 border border-gray-700 animate-pulse",children:[e.jsx("div",{className:"h-10 w-10 bg-gray-700 rounded-full mb-4"}),e.jsx("div",{className:"h-6 bg-gray-700 rounded mb-2 w-24"}),e.jsx("div",{className:"h-4 bg-gray-700 rounded w-32"})]},b))}):D.length===0?e.jsxs("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl p-12 border border-gray-700 text-center",children:[e.jsx(J,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"No Assets Yet"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"Start by depositing funds to your wallet"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:D.map(b=>{const v=f?.find(_=>_.asset===b.currency);return v?e.jsx(Be,{wallet:v,usdPrice:he[b.currency]||0,onSelect:()=>n?.(b.currency)},b.currency):null})})]})}const Re="https://xyvzpezqavqujpxodtre.supabase.co";async function $e(){const{data:n,error:m}=await U.from("blockchain_networks").select("*").eq("is_active",!0).order("network_name");return m?(console.error("Error fetching networks:",m),[]):n||[]}async function Ue(){try{const{data:n,error:m}=await U.from("custodial_addresses").select("*").eq("is_active",!0).order("created_at",{ascending:!1});if(m)return console.error("Error fetching deposit addresses:",m),[];if(!n||n.length===0)return console.log("No addresses found, returning empty array"),[];const h={ethereum:"ETH",bsc:"BSC",polygon:"POLYGON",solana:"SOL",tron:"TRON",bitcoin:"BTC"};return n.map(d=>({id:d.id,network_code:h[d.blockchain]||d.blockchain.toUpperCase(),address:d.address,is_verified:!0,created_at:d.created_at,derivation_path:d.derivation_path}))}catch(n){return console.error("Error in getDepositAddresses:",n),[]}}async function Me(n){try{const{data:{session:m}}=await U.auth.getSession();if(!m)throw new Error("Not authenticated");return await(await fetch(`${Re}/functions/v1/generate-deposit-address`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${m.access_token}`},body:JSON.stringify({network_code:n})})).json()}catch(m){return console.error("Error generating deposit address:",m),{success:!1,error:m instanceof Error?m.message:"Unknown error"}}}function Oe(n,m){return n.includes("tronscan")?`${n}/#/address/${m}`:n.includes("etherscan")||n.includes("bscscan")||n.includes("polygonscan")?`${n}/address/${m}`:n.includes("solana")?`${n}/address/${m}`:`${n}/address/${m}`}const be={bitcoin:["BTC"],ethereum:["ETH","USDT","USDC","TYT"],polygon:["MATIC","USDT","USDC"],solana:["SOL","USDT","TYT"],tron:["TRX","USDT"],ripple:["XRP"],ton:["TON","USDT"]};function Ye({selectedAsset:n,onSuccess:m}){const{user:h}=K(),[d,T]=a.useState([]),[C,t]=a.useState([]),[x,c]=a.useState(""),[g,o]=a.useState(n||"BTC"),[f,w]=a.useState(!1),[j,D]=a.useState(!1),[z,N]=a.useState(null),[b,v]=a.useState(null),[_,H]=a.useState(100),{data:L}=Te(_,g);a.useEffect(()=>{s(),u()},[]),a.useEffect(()=>{if(n){o(n);const r=k(n);r&&c(r)}},[n]);const s=async()=>{w(!0);try{const r=await $e();T(r),r.length>0&&!x&&c(r[0].network_code)}catch(r){console.error("Failed to load networks:",r),v("Failed to load blockchain networks")}finally{w(!1)}},u=async()=>{try{const r=await Ue();t(r)}catch(r){console.error("Failed to load addresses:",r)}},k=r=>{for(const[B,Y]of Object.entries(be))if(Y.includes(r))return B;return"bitcoin"},A=async()=>{if(x){D(!0),v(null);try{const r=await Me(x);r.success&&r.address?(await u(),m?.()):v(r.error||"Failed to generate address")}catch(r){console.error("Failed to generate address:",r),v(r.message||"Failed to generate deposit address")}finally{D(!1)}}},S=r=>{navigator.clipboard.writeText(r),N(r),setTimeout(()=>N(null),2e3)},p=C.find(r=>r.network_code===x),F=d.find(r=>r.network_code===x);return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl p-6 border border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-green-500/20 to-emerald-500/20 flex items-center justify-center",children:e.jsx(le,{className:"text-green-400",size:24})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Deposit Funds"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Send crypto to your wallet address"})]})]}),b&&e.jsxs("div",{className:"bg-red-900/20 border border-red-500/50 rounded-lg p-4 mb-6 flex items-start gap-3",children:[e.jsx(G,{className:"text-red-400 flex-shrink-0 mt-0.5",size:20}),e.jsx("div",{className:"text-sm text-red-200",children:b})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Select Asset"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:["BTC","ETH","TYT","USDT","SOL","TRX","XRP","TON"].map(r=>e.jsx("button",{onClick:()=>{o(r);const B=k(r);c(B)},className:`p-3 rounded-lg font-medium transition-all ${g===r?"bg-gold-500/20 text-gold-400 border border-gold-500/50":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:r},r))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Select Network"}),f?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(q,{className:"animate-spin text-gray-400",size:24})}):e.jsx("div",{className:"grid grid-cols-2 gap-2",children:d.filter(r=>be[r.network_code]?.includes(g)).map(r=>e.jsxs("button",{onClick:()=>c(r.network_code),className:`p-4 rounded-lg text-left transition-all ${x===r.network_code?"bg-green-500/20 text-green-400 border border-green-500/50":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:[e.jsx("div",{className:"font-semibold",children:r.network_name}),e.jsxs("div",{className:"text-xs opacity-70 mt-1",children:["Min confirmations: ",r.min_confirmations]})]},r.network_code))})]})]}),p?e.jsxs("div",{className:"bg-gray-700/50 rounded-xl p-6 border border-gray-600",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-semibold text-white",children:["Your ",F?.network_name," Address"]}),p.is_verified&&e.jsxs("span",{className:"flex items-center gap-1 text-xs text-green-400",children:[e.jsx(V,{size:14}),"Verified"]})]}),e.jsx("div",{className:"bg-gray-900 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"font-mono text-sm text-white break-all flex-1",children:p.address}),e.jsx("button",{onClick:()=>S(p.address),className:"flex-shrink-0 p-2 rounded-lg bg-gray-700 hover:bg-gray-600 transition-colors",title:"Copy address",children:z===p.address?e.jsx(V,{className:"text-green-400",size:18}):e.jsx(_e,{className:"text-gray-300",size:18})})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>window.open(Oe(x,p.address),"_blank"),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 rounded-lg bg-gray-700 hover:bg-gray-600 text-white transition-colors",children:[e.jsx(Ae,{size:16}),"View on Explorer"]}),e.jsxs("button",{className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 rounded-lg bg-gray-700 hover:bg-gray-600 text-white transition-colors",children:[e.jsx(Le,{size:16}),"Show QR Code"]})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("button",{onClick:A,disabled:j||!x,className:"px-8 py-3 rounded-lg bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 mx-auto",children:j?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"animate-spin",size:20}),"Generating Address..."]}):e.jsxs(e.Fragment,{children:[e.jsx(le,{size:20}),"Generate Deposit Address"]})}),e.jsx("p",{className:"text-sm text-gray-400 mt-4",children:"Click to generate a unique deposit address for this network"})]}),L&&e.jsx("div",{className:"mt-6 bg-blue-900/20 border border-blue-500/30 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(de,{className:"text-blue-400 flex-shrink-0 mt-0.5",size:20}),e.jsxs("div",{className:"flex-1 text-sm",children:[e.jsx("div",{className:"font-semibold text-blue-300 mb-2",children:"Fee Structure (10% total)"}),e.jsxs("div",{className:"space-y-1 text-blue-200",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Protocol (60%):"}),e.jsxs("span",{className:"font-mono",children:[L.protocol_fee||0," ",g]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Charity (30%):"}),e.jsxs("span",{className:"font-mono",children:[L.charity_fee||0," ",g]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Academy (10%):"}),e.jsxs("span",{className:"font-mono",children:[L.academy_fee||0," ",g]})]}),e.jsxs("div",{className:"flex justify-between border-t border-blue-500/30 pt-2 mt-2 font-semibold",children:[e.jsx("span",{children:"You receive:"}),e.jsxs("span",{className:"font-mono text-green-400",children:[L.net_amount||0," ",g]})]})]})]})]})}),e.jsx("div",{className:"mt-6 bg-amber-900/20 border border-amber-500/30 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(G,{className:"text-amber-400 flex-shrink-0 mt-0.5",size:20}),e.jsxs("div",{className:"text-sm text-amber-200",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Important Notes:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsxs("li",{children:["Only send ",g," to this address"]}),e.jsx("li",{children:"Sending other assets may result in permanent loss"}),e.jsxs("li",{children:["Wait for ",F?.min_confirmations||1," confirmations before using funds"]}),e.jsx("li",{children:"A 10% deposit fee applies (60% protocol, 30% charity, 10% academy)"})]})]})]})})]})})}const pe={BTC:95e3,ETH:3500,SOL:140,TRX:.15,XRP:2.5,TON:5.5,TYT:.05,USDT:1},We={BTC:1e-4,ETH:.001,SOL:.01,TRX:1,XRP:1,TON:.1,TYT:1,USDT:1};function Ie({selectedAsset:n,onSuccess:m}){const{user:h}=K(),{data:d,isLoading:T}=se(h?.id),{data:C}=Fe("withdraw.default"),[t,x]=a.useState(n||"BTC"),[c,g]=a.useState(""),[o,f]=a.useState(""),[w,j]=a.useState("mainnet"),[D,z]=a.useState(""),[N,b]=a.useState(""),[v,_]=a.useState(!1),[H,L]=a.useState(!1),[s,u]=a.useState(null),[k,A]=a.useState(!1),[S,p]=a.useState(null);a.useEffect(()=>{n&&x(n)},[n]),a.useEffect(()=>{h&&F()},[h,t]);const F=async()=>{if(h)try{const{data:y,error:M}=await U.from("withdrawal_limits").select("*").eq("user_id",h.id).maybeSingle();if(M)throw M;if(y)p(y);else{const{data:$}=await U.from("profiles").select("kyc_status").eq("id",h.id).maybeSingle();$?.kyc_status!=="approved"&&A(!0)}}catch(y){console.error("Failed to check limits:",y)}},r=d?.find(y=>y.asset===t),B=parseFloat(r?.balance||"0"),Y=parseFloat(r?.locked_balance||"0"),W=We[t]||0,X=C?.[0]?.fee_bps_total?C[0].fee_bps_total/1e4:.01,E=parseFloat(c)||0,R=E*X,Z=R*.6,i=R*.3,l=R*.1,P=E-R,I=o.length>10,O=E>=W&&E<=B,te=async()=>{if(!h||!I||!O){u("Please check your input values");return}_(!0),u(null);try{const{data:y,error:M}=await U.from("withdrawal_requests").insert({user_id:h.id,asset:t,amount:E,destination_address:o,network:w,memo:N||null,status:"pending",fee_amount:R,net_amount:P}).select().single();if(M)throw M;const{error:$}=await U.rpc("record_withdrawal_request",{p_user_id:h.id,p_asset:t,p_amount:E,p_fee:R,p_request_id:y.id});if($)throw $;L(!0),g(""),f(""),b(""),m?.(),setTimeout(()=>{L(!1)},5e3)}catch(y){console.error("Withdrawal failed:",y),u(y.message||"Failed to process withdrawal")}finally{_(!1)}},ae=()=>{g(B.toString())};return k?e.jsx("div",{className:"bg-gradient-to-br from-amber-900/20 to-amber-800/20 rounded-xl p-8 border border-amber-500/50",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(me,{className:"text-amber-400 flex-shrink-0 mt-1",size:32}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"KYC Verification Required"}),e.jsx("p",{className:"text-amber-200 mb-4",children:"To withdraw funds, you need to complete KYC verification. This is required by regulations to prevent fraud and money laundering."}),e.jsxs("a",{href:"/app/kyc",className:"inline-flex items-center gap-2 px-6 py-3 rounded-lg bg-gradient-to-r from-amber-600 to-orange-600 hover:from-amber-500 hover:to-orange-500 text-white font-semibold transition-all",children:[e.jsx(me,{size:18}),"Complete KYC Verification"]})]})]})}):e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl p-6 border border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-orange-500/20 to-red-500/20 flex items-center justify-center",children:e.jsx(ee,{className:"text-orange-400",size:24})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Withdraw Funds"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Send crypto to external address"})]})]}),H&&e.jsxs("div",{className:"bg-green-900/20 border border-green-500/50 rounded-lg p-4 mb-6 flex items-start gap-3",children:[e.jsx(V,{className:"text-green-400 flex-shrink-0 mt-0.5",size:20}),e.jsx("div",{className:"text-sm text-green-200",children:"Withdrawal request submitted successfully! It will be processed within 24 hours."})]}),s&&e.jsxs("div",{className:"bg-red-900/20 border border-red-500/50 rounded-lg p-4 mb-6 flex items-start gap-3",children:[e.jsx(G,{className:"text-red-400 flex-shrink-0 mt-0.5",size:20}),e.jsx("div",{className:"text-sm text-red-200",children:s})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Select Asset"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:["BTC","ETH","TYT","USDT","SOL","TRX","XRP","TON"].map(y=>{const M=d?.find(Ne=>Ne.asset===y),$=parseFloat(M?.balance||"0");return e.jsxs("button",{onClick:()=>x(y),disabled:$===0,className:`p-3 rounded-lg font-medium transition-all ${t===y?"bg-orange-500/20 text-orange-400 border border-orange-500/50":$===0?"bg-gray-800 text-gray-600 cursor-not-allowed":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:[e.jsx("div",{children:y}),e.jsx("div",{className:"text-xs opacity-70 mt-1",children:$.toFixed(4)})]},y)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Available Balance"}),e.jsx("div",{className:"bg-gray-700/50 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-2xl font-bold text-white",children:[B.toFixed(t==="BTC"?8:4)," ",t]}),e.jsxs("div",{className:"text-sm text-gray-400",children:["â‰ˆ $",(B*(pe[t]||0)).toFixed(2)," USD"]})]}),Y>0&&e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-gray-400",children:"Locked"}),e.jsx("div",{className:"text-lg font-semibold text-gold-400",children:Y.toFixed(t==="BTC"?8:4)})]})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Withdrawal Amount"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:c,onChange:y=>g(y.target.value),placeholder:`Min: ${W} ${t}`,step:t==="BTC"?"0.0001":"0.01",min:W,max:B,className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-orange-500"}),e.jsx("button",{onClick:ae,className:"absolute right-2 top-1/2 -translate-y-1/2 px-3 py-1 rounded bg-orange-500/20 text-orange-400 text-sm font-medium hover:bg-orange-500/30 transition-colors",children:"MAX"})]}),E>0&&e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["â‰ˆ $",(E*(pe[t]||0)).toFixed(2)," USD"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Destination Address"}),e.jsx("input",{type:"text",value:o,onChange:y=>f(y.target.value),placeholder:`Enter ${t} address`,className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-orange-500 font-mono text-sm"})]}),["XRP","TON"].includes(t)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Memo / Tag (Optional)"}),e.jsx("input",{type:"text",value:N,onChange:y=>b(y.target.value),placeholder:"Enter memo or destination tag",className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Network"}),e.jsxs("select",{value:w,onChange:y=>j(y.target.value),className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-orange-500",children:[e.jsx("option",{value:"mainnet",children:"Mainnet"}),t==="BTC"&&e.jsx("option",{value:"lightning",children:"Lightning Network"}),t==="ETH"&&e.jsx("option",{value:"polygon",children:"Polygon"})]})]})]}),E>0&&e.jsxs("div",{className:"bg-gray-700/50 rounded-lg p-4 mb-6",children:[e.jsx("h3",{className:"font-semibold text-white mb-3",children:"Transaction Summary"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Withdrawal Amount:"}),e.jsxs("span",{className:"font-mono text-white",children:[E.toFixed(8)," ",t]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Total Fee (1%):"}),e.jsxs("span",{className:"font-mono text-orange-400",children:["-",R.toFixed(8)," ",t]})]}),e.jsxs("div",{className:"ml-4 space-y-1 text-xs",children:[e.jsxs("div",{className:"flex justify-between text-gray-500",children:[e.jsx("span",{children:"â€¢ Protocol (60%):"}),e.jsx("span",{className:"font-mono",children:Z.toFixed(8)})]}),e.jsxs("div",{className:"flex justify-between text-gray-500",children:[e.jsx("span",{children:"â€¢ Charity (30%):"}),e.jsx("span",{className:"font-mono",children:i.toFixed(8)})]}),e.jsxs("div",{className:"flex justify-between text-gray-500",children:[e.jsx("span",{children:"â€¢ Academy (10%):"}),e.jsx("span",{className:"font-mono",children:l.toFixed(8)})]})]}),e.jsxs("div",{className:"flex justify-between border-t border-gray-600 pt-2 font-semibold",children:[e.jsx("span",{className:"text-white",children:"You will receive:"}),e.jsxs("span",{className:"font-mono text-green-400",children:[P.toFixed(8)," ",t]})]})]})]}),e.jsx("button",{onClick:te,disabled:v||!I||!O,className:"w-full py-4 rounded-lg bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-500 hover:to-red-500 text-white font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:v?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"animate-spin",size:20}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{size:20}),"Withdraw ",t]})}),e.jsx("div",{className:"mt-6 bg-blue-900/20 border border-blue-500/30 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(de,{className:"text-blue-400 flex-shrink-0 mt-0.5",size:20}),e.jsxs("div",{className:"text-sm text-blue-200",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Processing Time:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Standard withdrawals: 24-48 hours"}),e.jsx("li",{children:"Lightning Network: Instant"}),e.jsx("li",{children:"VIP members: Priority processing"})]})]})]})}),e.jsx("div",{className:"mt-4 bg-amber-900/20 border border-amber-500/30 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(De,{className:"text-amber-400 flex-shrink-0 mt-0.5",size:20}),e.jsxs("div",{className:"text-sm text-amber-200",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Important Notes:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Double-check the destination address"}),e.jsxs("li",{children:["Minimum withdrawal: ",W," ",t]}),e.jsx("li",{children:"Withdrawals are processed manually for security"}),e.jsx("li",{children:"A 1% fee applies (60% protocol, 30% charity, 10% academy)"})]})]})]})})]})})}const qe={BTC:95e3,ETH:3500,SOL:140,TRX:.15,XRP:2.5,TON:5.5,TYT:.05,USDT:1,USDC:1},ce=.003;function He({selectedAsset:n,onSuccess:m}){const{user:h}=K(),{data:d,isLoading:T,refetch:C}=se(h?.id),[t,x]=a.useState(n||"BTC"),[c,g]=a.useState("TYT"),[o,f]=a.useState(""),[w,j]=a.useState(""),[D,z]=a.useState(.5),[N,b]=a.useState(!1),[v,_]=a.useState(!1),[H,L]=a.useState(!1),[s,u]=a.useState(null),[k,A]=a.useState(0);a.useEffect(()=>{n&&x(n)},[n]),a.useEffect(()=>{o&&parseFloat(o)>0?r():j("")},[o,t,c]);const S=["BTC","ETH","TYT","USDT","SOL","TRX","XRP","TON","USDC"].map(l=>{const P=d?.find(I=>I.asset===l);return{symbol:l,name:l==="TYT"?"TYT Token":l,icon:l,balance:parseFloat(P?.balance||"0"),usdPrice:qe[l]||0}}),p=S.find(l=>l.symbol===t),F=S.find(l=>l.symbol===c),r=()=>{const l=parseFloat(o);if(!l||!p||!F)return;const P=l*p.usdPrice,I=P*ce,te=(P-I)/F.usdPrice;j(te.toFixed(8));const ae=I/P*100;A(ae)},B=async()=>{if(!h||!o||!w){u("Please enter swap amounts");return}const l=parseFloat(o);if(l<=0||l>(p?.balance||0)){u("Invalid amount or insufficient balance");return}b(!0),u(null);try{const P=l*(p?.usdPrice||0),I=parseFloat(w)*(F?.usdPrice||0),O=P*ce,te=O*.6,ae=O*.3,y=O*.1,{error:M}=await U.from("token_swaps").insert({user_id:h.id,from_asset:t,to_asset:c,from_amount:l,to_amount:parseFloat(w),exchange_rate:(p?.usdPrice||0)/(F?.usdPrice||0),fee_amount:O,fee_asset:"USD",status:"completed",executed_at:new Date().toISOString()});if(M)throw M;const{error:$}=await U.rpc("process_swap_transaction",{p_user_id:h.id,p_from_asset:t,p_to_asset:c,p_from_amount:l,p_to_amount:parseFloat(w),p_fee_usd:O});if($)throw $;L(!0),f(""),j(""),C(),m?.(),setTimeout(()=>{L(!1)},5e3)}catch(P){console.error("Swap failed:",P),u(P.message||"Failed to execute swap")}finally{b(!1)}},Y=()=>{x(c),g(t),f(""),j("")},W=()=>{p&&f(p.balance.toString())},X=p&&F?(p.usdPrice/F.usdPrice).toFixed(6):"0",E=parseFloat(o)*(p?.usdPrice||0)*ce,R=E*.6,Z=E*.3,i=E*.1;return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl p-6 border border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-500/20 to-cyan-500/20 flex items-center justify-center",children:e.jsx(ie,{className:"text-blue-400",size:24})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Swap Tokens"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Exchange between supported assets"})]})]}),H&&e.jsxs("div",{className:"bg-green-900/20 border border-green-500/50 rounded-lg p-4 mb-6 flex items-start gap-3",children:[e.jsx(V,{className:"text-green-400 flex-shrink-0 mt-0.5",size:20}),e.jsx("div",{className:"text-sm text-green-200",children:"Swap completed successfully! Your balances have been updated."})]}),s&&e.jsxs("div",{className:"bg-red-900/20 border border-red-500/50 rounded-lg p-4 mb-6 flex items-start gap-3",children:[e.jsx(G,{className:"text-red-400 flex-shrink-0 mt-0.5",size:20}),e.jsx("div",{className:"text-sm text-red-200",children:s})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-700/50 rounded-xl p-4 border border-gray-600",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"From"}),e.jsxs("span",{className:"text-xs text-gray-400",children:["Balance: ",p?.balance.toFixed(t==="BTC"?8:4)||"0"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("select",{value:t,onChange:l=>x(l.target.value),className:"px-4 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white font-semibold focus:outline-none focus:border-blue-500",children:S.map(l=>e.jsx("option",{value:l.symbol,disabled:l.symbol===c,children:l.symbol},l.symbol))}),e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{type:"number",value:o,onChange:l=>f(l.target.value),placeholder:"0.0",step:"0.0001",className:"w-full px-4 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white text-right text-xl font-semibold focus:outline-none focus:border-blue-500"}),e.jsx("button",{onClick:W,className:"absolute right-2 top-1/2 -translate-y-1/2 px-2 py-1 rounded bg-blue-500/20 text-blue-400 text-xs font-medium hover:bg-blue-500/30 transition-colors",children:"MAX"})]})]}),o&&parseFloat(o)>0&&e.jsxs("div",{className:"text-xs text-gray-400 mt-2 text-right",children:["â‰ˆ $",(parseFloat(o)*(p?.usdPrice||0)).toFixed(2)," USD"]})]}),e.jsx("div",{className:"flex justify-center -my-2 relative z-10",children:e.jsx("button",{onClick:Y,className:"p-3 rounded-full bg-gray-700 hover:bg-gray-600 border-4 border-gray-900 transition-all hover:rotate-180 duration-300",children:e.jsx(ze,{className:"text-blue-400",size:20})})}),e.jsxs("div",{className:"bg-gray-700/50 rounded-xl p-4 border border-gray-600",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"To"}),e.jsxs("span",{className:"text-xs text-gray-400",children:["Balance: ",F?.balance.toFixed(c==="BTC"?8:4)||"0"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("select",{value:c,onChange:l=>g(l.target.value),className:"px-4 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white font-semibold focus:outline-none focus:border-blue-500",children:S.map(l=>e.jsx("option",{value:l.symbol,disabled:l.symbol===t,children:l.symbol},l.symbol))}),e.jsx("input",{type:"number",value:w,readOnly:!0,placeholder:"0.0",className:"flex-1 px-4 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white text-right text-xl font-semibold focus:outline-none"})]}),w&&parseFloat(w)>0&&e.jsxs("div",{className:"text-xs text-gray-400 mt-2 text-right",children:["â‰ˆ $",(parseFloat(w)*(F?.usdPrice||0)).toFixed(2)," USD"]})]})]}),o&&parseFloat(o)>0&&e.jsx("div",{className:"mt-6 bg-gray-700/50 rounded-lg p-4",children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Exchange Rate:"}),e.jsxs("span",{className:"font-mono text-white",children:["1 ",t," = ",X," ",c]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Swap Fee (0.3%):"}),e.jsxs("span",{className:"font-mono text-blue-400",children:["$",E.toFixed(4)]})]}),e.jsxs("div",{className:"ml-4 space-y-1 text-xs",children:[e.jsxs("div",{className:"flex justify-between text-gray-500",children:[e.jsx("span",{children:"â€¢ Protocol (60%):"}),e.jsxs("span",{className:"font-mono",children:["$",R.toFixed(4)]})]}),e.jsxs("div",{className:"flex justify-between text-gray-500",children:[e.jsx("span",{children:"â€¢ Charity (30%):"}),e.jsxs("span",{className:"font-mono",children:["$",Z.toFixed(4)]})]}),e.jsxs("div",{className:"flex justify-between text-gray-500",children:[e.jsx("span",{children:"â€¢ Academy (10%):"}),e.jsxs("span",{className:"font-mono",children:["$",i.toFixed(4)]})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Slippage Tolerance:"}),e.jsxs("span",{className:"text-white",children:[D,"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Price Impact:"}),e.jsxs("span",{className:k>1?"text-amber-400":"text-green-400",children:[k.toFixed(2),"%"]})]})]})}),e.jsx("div",{className:"mt-6 flex gap-2",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs text-gray-400 mb-2",children:"Slippage Tolerance"}),e.jsx("div",{className:"flex gap-2",children:[.1,.5,1].map(l=>e.jsxs("button",{onClick:()=>z(l),className:`flex-1 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${D===l?"bg-blue-500/20 text-blue-400 border border-blue-500/50":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:[l,"%"]},l))})]})}),e.jsx("button",{onClick:B,disabled:N||!o||parseFloat(o)<=0||parseFloat(o)>(p?.balance||0),className:"w-full mt-6 py-4 rounded-lg bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-500 hover:to-cyan-500 text-white font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:N?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"animate-spin",size:20}),"Swapping..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ie,{size:20}),"Swap ",t," for ",c]})}),e.jsx("div",{className:"mt-6 bg-blue-900/20 border border-blue-500/30 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(de,{className:"text-blue-400 flex-shrink-0 mt-0.5",size:20}),e.jsxs("div",{className:"text-sm text-blue-200",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Swap Details:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Instant execution"}),e.jsx("li",{children:"0.3% swap fee (60% protocol, 30% charity, 10% academy)"}),e.jsx("li",{children:"Best rates aggregated from multiple sources"}),e.jsx("li",{children:"No minimum amount required"})]})]})]})})]})})}const re=[{id:"ethereum",name:"Ethereum",icon:"Îž",assets:["ETH","USDT","USDC","TYT"],bridgeFee:.005,estimatedTime:"10-15 min"},{id:"polygon",name:"Polygon",icon:"â¬£",assets:["MATIC","USDT","USDC","TYT"],bridgeFee:.002,estimatedTime:"5-10 min"},{id:"solana",name:"Solana",icon:"â—Ž",assets:["SOL","USDT","TYT"],bridgeFee:.001,estimatedTime:"2-5 min"},{id:"tron",name:"TRON",icon:"â¬£",assets:["TRX","USDT"],bridgeFee:.001,estimatedTime:"3-5 min"},{id:"ton",name:"TON",icon:"ðŸ’Ž",assets:["TON","USDT"],bridgeFee:.002,estimatedTime:"5-8 min"}];function Xe({onSuccess:n}){const{user:m}=K(),{data:h,refetch:d}=se(m?.id),[T,C]=a.useState("ethereum"),[t,x]=a.useState("polygon"),[c,g]=a.useState("USDT"),[o,f]=a.useState(""),[w,j]=a.useState(""),[D,z]=a.useState(!1),[N,b]=a.useState(!1),[v,_]=a.useState(null),[H,L]=a.useState(!1),s=re.find(i=>i.id===T),u=re.find(i=>i.id===t),k=s?.assets.filter(i=>u?.assets.includes(i))||[];a.useEffect(()=>{!k.includes(c)&&k.length>0&&g(k[0])},[T,t]);const A=h?.find(i=>i.asset===c),S=parseFloat(A?.balance||"0"),p=s?.bridgeFee||0,F=parseFloat(o)||0,r=F*p,B=r*.6,Y=r*.3,W=r*.1,X=F-r,E=async()=>{if(!m||!o||!w){_("Please fill in all fields");return}if(F<=0||F>S){_("Invalid amount or insufficient balance");return}if(T===t){_("Source and destination chains must be different");return}z(!0),_(null);try{const{error:i}=await U.from("cross_chain_transfers").insert({user_id:m.id,source_chain:T,destination_chain:t,asset:c,amount:F,destination_address:w,bridge_fee:r,net_amount:X,status:"pending",initiated_at:new Date().toISOString()});if(i)throw i;const{error:l}=await U.rpc("record_bridge_transfer",{p_user_id:m.id,p_asset:c,p_amount:F,p_fee:r,p_from_chain:T,p_to_chain:t});if(l)throw l;b(!0),f(""),j(""),d(),n?.(),setTimeout(()=>{b(!1)},5e3)}catch(i){console.error("Bridge failed:",i),_(i.message||"Failed to initiate bridge transfer")}finally{z(!1)}},R=()=>{f(S.toString())},Z=()=>{const i=T;C(t),x(i)};return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl p-6 border border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-purple-500/20 to-pink-500/20 flex items-center justify-center",children:e.jsx(oe,{className:"text-purple-400",size:24})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Cross-Chain Bridge"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Transfer assets between blockchains"})]})]}),N&&e.jsxs("div",{className:"bg-green-900/20 border border-green-500/50 rounded-lg p-4 mb-6 flex items-start gap-3",children:[e.jsx(V,{className:"text-green-400 flex-shrink-0 mt-0.5",size:20}),e.jsxs("div",{className:"text-sm text-green-200",children:["Bridge transfer initiated! Estimated completion: ",s?.estimatedTime]})]}),v&&e.jsxs("div",{className:"bg-red-900/20 border border-red-500/50 rounded-lg p-4 mb-6 flex items-start gap-3",children:[e.jsx(G,{className:"text-red-400 flex-shrink-0 mt-0.5",size:20}),e.jsx("div",{className:"text-sm text-red-200",children:v})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-700/50 rounded-xl p-4 border border-gray-600",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm font-medium text-gray-300",children:"From Chain"}),e.jsxs("span",{className:"text-xs text-gray-400",children:["Balance: ",S.toFixed(4)," ",c]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mb-3",children:re.map(i=>e.jsx("button",{onClick:()=>C(i.id),disabled:i.id===t,className:`p-3 rounded-lg text-left transition-all ${T===i.id?"bg-purple-500/20 text-purple-400 border border-purple-500/50":i.id===t?"bg-gray-800 text-gray-600 cursor-not-allowed":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:i.icon}),e.jsx("span",{className:"font-semibold",children:i.name})]})},i.id))}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:o,onChange:i=>f(i.target.value),placeholder:"0.0",step:"0.0001",className:"w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg text-white text-lg font-semibold focus:outline-none focus:border-purple-500"}),e.jsx("button",{onClick:R,className:"absolute right-2 top-1/2 -translate-y-1/2 px-3 py-1 rounded bg-purple-500/20 text-purple-400 text-sm font-medium hover:bg-purple-500/30 transition-colors",children:"MAX"})]})]}),e.jsx("div",{className:"flex justify-center -my-2 relative z-10",children:e.jsx("button",{onClick:Z,className:"p-3 rounded-full bg-gray-700 hover:bg-gray-600 border-4 border-gray-900 transition-all hover:rotate-180 duration-300",children:e.jsx(ve,{className:"text-purple-400",size:20})})}),e.jsxs("div",{className:"bg-gray-700/50 rounded-xl p-4 border border-gray-600",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm font-medium text-gray-300",children:"To Chain"}),e.jsxs("span",{className:"text-xs text-gray-400",children:["Receive: ",X.toFixed(4)," ",c]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mb-3",children:re.map(i=>e.jsx("button",{onClick:()=>x(i.id),disabled:i.id===T,className:`p-3 rounded-lg text-left transition-all ${t===i.id?"bg-purple-500/20 text-purple-400 border border-purple-500/50":i.id===T?"bg-gray-800 text-gray-600 cursor-not-allowed":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:i.icon}),e.jsx("span",{className:"font-semibold",children:i.name})]})},i.id))}),e.jsx("input",{type:"text",value:w,onChange:i=>j(i.target.value),placeholder:`Destination address on ${u?.name}`,className:"w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg text-white font-mono text-sm focus:outline-none focus:border-purple-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Select Asset to Bridge"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:k.map(i=>e.jsx("button",{onClick:()=>g(i),className:`p-3 rounded-lg font-medium transition-all ${c===i?"bg-purple-500/20 text-purple-400 border border-purple-500/50":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:i},i))})]})]}),o&&parseFloat(o)>0&&e.jsxs("div",{className:"mt-6 bg-gray-700/50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-white mb-3",children:"Bridge Summary"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Bridge Amount:"}),e.jsxs("span",{className:"font-mono text-white",children:[F.toFixed(6)," ",c]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-gray-400",children:["Bridge Fee (",(p*100).toFixed(1),"%):"]}),e.jsxs("span",{className:"font-mono text-purple-400",children:["-",r.toFixed(6)," ",c]})]}),e.jsxs("div",{className:"ml-4 space-y-1 text-xs",children:[e.jsxs("div",{className:"flex justify-between text-gray-500",children:[e.jsx("span",{children:"â€¢ Protocol (60%):"}),e.jsx("span",{className:"font-mono",children:B.toFixed(6)})]}),e.jsxs("div",{className:"flex justify-between text-gray-500",children:[e.jsx("span",{children:"â€¢ Charity (30%):"}),e.jsx("span",{className:"font-mono",children:Y.toFixed(6)})]}),e.jsxs("div",{className:"flex justify-between text-gray-500",children:[e.jsx("span",{children:"â€¢ Academy (10%):"}),e.jsx("span",{className:"font-mono",children:W.toFixed(6)})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Estimated Time:"}),e.jsx("span",{className:"text-white",children:s?.estimatedTime})]}),e.jsxs("div",{className:"flex justify-between border-t border-gray-600 pt-2 font-semibold",children:[e.jsx("span",{className:"text-white",children:"You will receive:"}),e.jsxs("span",{className:"font-mono text-green-400",children:[X.toFixed(6)," ",c]})]})]})]}),e.jsx("button",{onClick:E,disabled:D||!o||!w||parseFloat(o)<=0||parseFloat(o)>S||T===t,className:"w-full mt-6 py-4 rounded-lg bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 text-white font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:D?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"animate-spin",size:20}),"Bridging..."]}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{size:20}),"Bridge ",c," to ",u?.name]})}),e.jsx("div",{className:"mt-6 bg-blue-900/20 border border-blue-500/30 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(de,{className:"text-blue-400 flex-shrink-0 mt-0.5",size:20}),e.jsxs("div",{className:"text-sm text-blue-200",children:[e.jsx("div",{className:"font-semibold mb-2",children:"How Bridge Works:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Assets are locked on source chain"}),e.jsx("li",{children:"Equivalent amount minted on destination chain"}),e.jsx("li",{children:"Fully decentralized and secure"}),e.jsx("li",{children:"Track progress in transaction history"})]})]})]})}),e.jsx("div",{className:"mt-4 bg-amber-900/20 border border-amber-500/30 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(me,{className:"text-amber-400 flex-shrink-0 mt-0.5",size:20}),e.jsxs("div",{className:"text-sm text-amber-200",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Important Notes:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Verify destination address carefully"}),e.jsx("li",{children:"Bridge transfers cannot be reversed"}),e.jsx("li",{children:"Processing time varies by network congestion"}),e.jsx("li",{children:"Keep transaction ID for support"})]})]})]})})]})})}const Ve={deposit:le,withdrawal:ee,swap:ie,bridge:oe,reward:V,fee:Se,stake:V,unstake:ee},Ke={deposit:"text-green-400",withdrawal:"text-orange-400",swap:"text-blue-400",bridge:"text-purple-400",reward:"text-gold-400",fee:"text-red-400",stake:"text-cyan-400",unstake:"text-amber-400"};function Ge({compact:n=!1,limit:m}){const{user:h}=K(),[d,T]=a.useState("all"),[C,t]=a.useState("all"),[x,c]=a.useState(""),[g,o]=a.useState(""),[f,w]=a.useState(""),{data:j,isLoading:D,refetch:z}=ye(h?.id,{limit:m||100,entryType:d!=="all"?d:void 0,currency:C!=="all"?C:void 0}),N=a.useMemo(()=>{if(!j)return[];let s=[...j];if(x){const u=x.toLowerCase();s=s.filter(k=>k.currency.toLowerCase().includes(u)||k.entry_type.toLowerCase().includes(u)||k.description?.toLowerCase().includes(u)||k.reference_id?.toLowerCase().includes(u))}return g&&(s=s.filter(u=>new Date(u.created_at)>=new Date(g))),f&&(s=s.filter(u=>new Date(u.created_at)<=new Date(f))),s},[j,x,g,f]),b=a.useMemo(()=>{if(!j)return[];const s=new Set(j.map(u=>u.currency));return Array.from(s).sort()},[j]),v=a.useMemo(()=>{if(!j)return[];const s=new Set(j.map(u=>u.entry_type));return Array.from(s).sort()},[j]),_=()=>{if(!N||N.length===0)return;const s=[["Date","Type","Currency","Amount","Balance","Description"].join(","),...N.map(S=>[new Date(S.created_at).toISOString(),S.entry_type,S.currency,S.amount,S.balance_after,S.description||""].join(","))].join(`
`),u=new Blob([s],{type:"text/csv"}),k=URL.createObjectURL(u),A=document.createElement("a");A.href=k,A.download=`wallet-history-${Date.now()}.csv`,A.click(),URL.revokeObjectURL(k)},H=s=>{const u=new Date(s),A=new Date().getTime()-u.getTime(),S=Math.floor(A/(1e3*60*60*24));if(S===0){const p=Math.floor(A/36e5);return p===0?`${Math.floor(A/6e4)}m ago`:`${p}h ago`}else{if(S===1)return"Yesterday";if(S<7)return`${S}d ago`}return u.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},L=({entry:s})=>{const u=Ve[s.entry_type]||ne,k=Ke[s.entry_type]||"text-gray-400",A=parseFloat(s.amount)>0;return e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-gray-800/50 rounded-lg hover:bg-gray-700/50 transition-colors",children:[e.jsx("div",{className:`w-10 h-10 rounded-full bg-gray-700 flex items-center justify-center ${k}`,children:e.jsx(u,{size:20})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"font-semibold text-white capitalize",children:s.entry_type.replace("_"," ")}),s.reference_id&&e.jsxs("span",{className:"text-xs text-gray-500 font-mono truncate max-w-[100px]",children:["#",s.reference_id.slice(0,8)]})]}),e.jsx("div",{className:"text-sm text-gray-400 truncate",children:s.description||`${s.entry_type} transaction`}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:H(s.created_at)})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:`text-lg font-semibold ${A?"text-green-400":"text-gray-300"}`,children:[A?"+":"",parseFloat(s.amount).toFixed(s.currency==="BTC"?8:4)," ",s.currency]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Balance: ",parseFloat(s.balance_after||"0").toFixed(s.currency==="BTC"?8:4)]})]})]})};return n?e.jsx("div",{className:"space-y-3",children:D?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(q,{className:"animate-spin text-gray-400",size:24})}):N.length===0?e.jsx("div",{className:"text-center py-8 text-gray-400",children:"No transactions yet"}):N.slice(0,m||5).map(s=>e.jsx(L,{entry:s},s.id))}):e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl p-6 border border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-gray-700 to-gray-800 flex items-center justify-center",children:e.jsx(ne,{className:"text-gray-300",size:24})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Transaction History"}),e.jsxs("p",{className:"text-sm text-gray-400",children:[N.length," transaction",N.length!==1?"s":""]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>z(),disabled:D,className:"p-2 rounded-lg bg-gray-700 hover:bg-gray-600 transition-colors disabled:opacity-50",title:"Refresh",children:e.jsx(q,{size:18,className:D?"animate-spin":""})}),e.jsxs("button",{onClick:_,disabled:N.length===0,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-gray-700 hover:bg-gray-600 transition-colors disabled:opacity-50",title:"Export CSV",children:[e.jsx(Ee,{size:18}),"Export"]})]})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(we,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",value:x,onChange:s=>c(s.target.value),placeholder:"Search transactions...",className:"w-full pl-10 pr-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-blue-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Type"}),e.jsxs("select",{value:d,onChange:s=>T(s.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:border-blue-500",children:[e.jsx("option",{value:"all",children:"All Types"}),v.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Currency"}),e.jsxs("select",{value:C,onChange:s=>t(s.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:border-blue-500",children:[e.jsx("option",{value:"all",children:"All Currencies"}),b.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"From Date"}),e.jsx("input",{type:"date",value:g,onChange:s=>o(s.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"To Date"}),e.jsx("input",{type:"date",value:f,onChange:s=>w(s.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:border-blue-500"})]})]}),(d!=="all"||C!=="all"||x||g||f)&&e.jsx("button",{onClick:()=>{T("all"),t("all"),c(""),o(""),w("")},className:"text-sm text-blue-400 hover:text-blue-300 transition-colors",children:"Clear all filters"})]}),e.jsx("div",{className:"space-y-3",children:D?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(q,{className:"animate-spin text-gray-400",size:32})}):N.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ne,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"No Transactions Found"}),e.jsx("p",{className:"text-gray-400",children:x||d!=="all"||C!=="all"?"Try adjusting your filters":"Your transaction history will appear here"})]}):e.jsxs(e.Fragment,{children:[N.map(s=>e.jsx(L,{entry:s},s.id)),N.length>=(m||100)&&e.jsx("div",{className:"text-center pt-4",children:e.jsxs("p",{className:"text-sm text-gray-400",children:["Showing ",N.length," transactions. Use filters to refine results."]})})]})})]})})}const Qe=[{id:"balance",label:"Balance",icon:J,color:"text-blue-400",gradient:"from-blue-500/20 to-cyan-600/20"},{id:"deposit",label:"Deposit",icon:le,color:"text-green-400",gradient:"from-green-500/20 to-emerald-600/20"},{id:"withdraw",label:"Withdraw",icon:ee,color:"text-orange-400",gradient:"from-orange-500/20 to-amber-600/20"},{id:"swap",label:"Swap",icon:ie,color:"text-purple-400",gradient:"from-purple-500/20 to-pink-600/20"},{id:"bridge",label:"Bridge",icon:oe,color:"text-cyan-400",gradient:"from-cyan-500/20 to-blue-600/20"},{id:"history",label:"History",icon:ne,color:"text-gray-400",gradient:"from-gray-500/20 to-slate-600/20"}];function ds(){const{user:n}=K(),{data:m=[],isLoading:h,refetch:d}=se(n?.id),{data:T=[]}=je(n?.id),{data:C=[]}=ye(n?.id,{limit:50}),[t,x]=a.useState("balance"),c=T.reduce((g,o)=>{const f=parseFloat(o.usd_value||"0");return g+f},0);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-white flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center shadow-lg",children:e.jsx(J,{size:28,className:"text-white"})}),"Ecosystem Wallet"]}),e.jsx("p",{className:"text-gray-400 mt-2",children:"Unified wallet for all your crypto needs"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-amber-500/10 to-orange-600/10 border border-amber-500/30 rounded-xl p-6 min-w-[280px]",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"Total Portfolio Value"}),e.jsxs("div",{className:"text-3xl font-bold text-white flex items-center gap-2",children:["$",c.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),e.jsx(fe,{size:20,className:"text-green-400"})]}),e.jsxs("div",{className:"text-xs text-green-400 mt-1 flex items-center gap-1",children:[e.jsx(ke,{size:12}),"+5.2% (24h)"]})]})]}),e.jsx("div",{className:"bg-gray-800/50 border border-gray-700/50 rounded-xl p-2 backdrop-blur-sm",children:e.jsx("div",{className:"grid grid-cols-6 gap-2",children:Qe.map(g=>{const o=g.icon,f=t===g.id;return e.jsxs("button",{onClick:()=>x(g.id),className:`
                  flex flex-col items-center gap-2 py-4 px-4 rounded-lg transition-all duration-200
                  ${f?`bg-gradient-to-br ${g.gradient} border border-current/30 shadow-lg scale-105`:"hover:bg-gray-700/50 border border-transparent"}
                `,children:[e.jsx(o,{size:24,className:f?g.color:"text-gray-500"}),e.jsx("span",{className:`text-sm font-semibold ${f?"text-white":"text-gray-500"}`,children:g.label})]},g.id)})})}),e.jsxs("div",{className:"min-h-[600px]",children:[t==="balance"&&e.jsx(Pe,{onSelectAsset:g=>{x("deposit")}}),t==="deposit"&&e.jsx(Ye,{onSuccess:d}),t==="withdraw"&&e.jsx(Ie,{onSuccess:d}),t==="swap"&&e.jsx(He,{onSuccess:d}),t==="bridge"&&e.jsx(Xe,{onSuccess:d}),t==="history"&&e.jsx(Ge,{})]})]})}export{ds as default};
