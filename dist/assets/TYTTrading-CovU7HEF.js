import{c as I,z as h,E as q,al as K,r as c,j as e,W as v,D as V,e as Z,K as J,J as Q,U as G,O as X,A as P,Z as $}from"./index-Cb_Vey4A.js";import{R as N}from"./refresh-cw-DbeEGu-Y.js";import{E as ee}from"./external-link-Dv1yQxy7.js";import{A}from"./activity-XNIBoXMN.js";import{A as D}from"./arrow-down-left-ouAMLqxy.js";import{A as L}from"./arrow-up-right-D1jRNhcf.js";import{C as te}from"./clock-ClFQAG9n.js";const se=I("Droplets",[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]]);async function T(){try{return{price:234e-8,marketCap:234e3,volume24h:12500,priceChange24h:15.7,holders:842,totalSupply:1e9,liquidity:45e3}}catch(t){throw console.error("Error fetching TYT token data:",t),t}}async function U(t){try{const{data:r,error:n}=await h.rpc("get_user_tyt_holdings",{p_user_id:t});return!n&&r&&r.length>0?r[0]:(console.log("No TYT holdings found or RPC unavailable, returning zero balance"),{total_tyt_bought:0,total_tyt_sold:0,net_tyt_balance:0,total_sol_spent:0,total_sol_received:0,average_buy_price:0,trade_count:0})}catch(r){return console.error("Error fetching TYT holdings:",r),{total_tyt_bought:0,total_tyt_sold:0,net_tyt_balance:0,total_sol_spent:0,total_sol_received:0,average_buy_price:0,trade_count:0}}}async function re(t){try{const{data:r,error:n}=await h.from("tyt_token_trades").select("*").eq("user_id",t).order("created_at",{ascending:!1}).limit(50);if(n)throw n;return r||[]}catch(r){return console.error("Error fetching trades:",r),[]}}async function ae(t,r,n){try{if(!n||!n.publicKey)throw new Error("Wallet not connected");const l=await T(),u=r/l.price,{data:{user:a}}=await h.auth.getUser();if(!a)throw new Error("User not authenticated");const{data:j,error:o}=await h.from("tyt_token_trades").insert({user_id:a.id,wallet_address:t,trade_type:"buy",sol_amount:r,tyt_amount:u,price_per_token:l.price,total_value_usd:r*140,status:"pending"}).select().single();if(o)throw o;return{success:!0,signature:`mock_tx_${Date.now()}`}}catch(l){return console.error("Error buying TYT:",l),{success:!1,error:l instanceof Error?l.message:"Unknown error"}}}async function le(t,r,n){try{if(!n||!n.publicKey)throw new Error("Wallet not connected");const l=await T(),u=r*l.price,{data:{user:a}}=await h.auth.getUser();if(!a)throw new Error("User not authenticated");if((await U(a.id)).net_tyt_balance<r)throw new Error("Insufficient TYT balance");const{data:o,error:b}=await h.from("tyt_token_trades").insert({user_id:a.id,wallet_address:t,trade_type:"sell",sol_amount:u,tyt_amount:r,price_per_token:l.price,total_value_usd:u*140,status:"pending"}).select().single();if(b)throw b;return{success:!0,signature:`mock_tx_${Date.now()}`}}catch(l){return console.error("Error selling TYT:",l),{success:!1,error:l instanceof Error?l.message:"Unknown error"}}}function ne(t){return!t||t.length<12?t:`${t.slice(0,4)}...${t.slice(-4)}`}function g(t,r=2){return t>=1e6?`${(t/1e6).toFixed(r)}M`:t>=1e3?`${(t/1e3).toFixed(r)}K`:t.toFixed(r)}function oe(t){return t>0?"text-green-400":t<0?"text-red-400":"text-gray-400"}function he(){const{user:t}=q(),{connectedWallet:r,connectPhantom:n,isConnecting:l,getProvider:u}=K(),[a,j]=c.useState(null),[o,b]=c.useState(null),[w,B]=c.useState([]),[R,_]=c.useState(!0),[k,Y]=c.useState(!1),[C,m]=c.useState(null),[d,S]=c.useState(""),[x,E]=c.useState(""),[p,f]=c.useState(!1),y=async()=>{if(!t){_(!1);return}try{console.log("Loading TYT Trading data for user:",t.id);const[s,i,F]=await Promise.all([T(),U(t.id),re(t.id)]);console.log("TYT Data loaded:",{token:s,userHoldings:i,userTrades:F}),j(s),b(i),B(F)}catch(s){console.error("Error loading TYT data:",s)}finally{_(!1)}},M=async()=>{Y(!0),await y(),Y(!1)},O=async()=>{if(!(!r||!d||parseFloat(d)<=0)){f(!0);try{const s=u(),i=await ae(r.wallet_address,parseFloat(d),s);i.success?(alert(`Purchase initiated!
Transaction: ${i.signature?.slice(0,16)}...`),m(null),S(""),await y()):alert(`Purchase failed: ${i.error}`)}catch(s){console.error("Error buying TYT:",s),alert("Failed to buy TYT tokens")}finally{f(!1)}}},W=async()=>{if(!(!r||!x||parseFloat(x)<=0)){f(!0);try{const s=u(),i=await le(r.wallet_address,parseFloat(x),s);i.success?(alert(`Sale initiated!
Transaction: ${i.signature?.slice(0,16)}...`),m(null),E(""),await y()):alert(`Sale failed: ${i.error}`)}catch(s){console.error("Error selling TYT:",s),alert("Failed to sell TYT tokens")}finally{f(!1)}}};if(c.useEffect(()=>{t&&y()},[t?.id]),R)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 border-3 border-amber-400 border-t-transparent rounded-full animate-spin"}),e.jsx("div",{className:"text-gray-400",children:"Loading TYT trading..."})]})});const z=d&&a?parseFloat(d)/a.price:0,H=x&&a?parseFloat(x)*a.price:0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold mb-2 flex items-center gap-3",children:[e.jsx("span",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-amber-400 to-orange-500 flex items-center justify-center text-white font-bold",children:"T"}),"TYT Token Trading"]}),e.jsx("p",{className:"text-gray-400",children:"Trade TYT on Pump.fun via Solana blockchain"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[r?e.jsxs("div",{className:"px-4 py-2 bg-green-500/20 border border-green-500/50 rounded-lg flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-400 animate-pulse"}),e.jsx("span",{className:"text-sm font-mono",children:ne(r.wallet_address)})]}):e.jsx("button",{onClick:n,disabled:l,className:"px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 rounded-lg font-semibold hover:from-purple-400 hover:to-pink-400 transition-all disabled:opacity-50 flex items-center gap-2",children:l?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"w-5 h-5 animate-spin"}),"Connecting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"w-5 h-5"}),"Connect Phantom"]})}),e.jsxs("button",{onClick:M,disabled:k,className:"px-4 py-2 bg-gray-800 rounded-lg font-semibold hover:bg-gray-700 transition-all flex items-center gap-2 disabled:opacity-50",children:[e.jsx(N,{className:`w-5 h-5 ${k?"animate-spin":""}`}),"Refresh"]})]})]}),a&&e.jsx("div",{className:"bg-gradient-to-br from-amber-500/20 to-orange-500/20 rounded-xl p-6 border border-amber-500/50",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm text-gray-300 mb-2 flex items-center gap-2",children:[e.jsx(V,{className:"w-4 h-4"}),"Price"]}),e.jsxs("div",{className:"text-3xl font-bold text-amber-400 mb-1",children:["$",a.price.toFixed(8)]}),e.jsxs("div",{className:`text-sm font-semibold flex items-center gap-1 ${oe(a.priceChange24h)}`,children:[a.priceChange24h>0?e.jsx(Z,{className:"w-4 h-4"}):e.jsx(J,{className:"w-4 h-4"}),a.priceChange24h>0?"+":"",a.priceChange24h.toFixed(2),"% (24h)"]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm text-gray-300 mb-2 flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),"Market Cap"]}),e.jsxs("div",{className:"text-2xl font-bold text-white mb-1",children:["$",g(a.marketCap)]}),e.jsxs("div",{className:"text-sm text-gray-400",children:["Vol: $",g(a.volume24h)]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm text-gray-300 mb-2 flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4"}),"Holders"]}),e.jsx("div",{className:"text-2xl font-bold text-white mb-1",children:a.holders.toLocaleString()}),e.jsxs("div",{className:"text-sm text-gray-400",children:["Supply: ",g(a.totalSupply)]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm text-gray-300 mb-2 flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4"}),"Liquidity"]}),e.jsxs("div",{className:"text-2xl font-bold text-white mb-1",children:["$",g(a.liquidity)]}),e.jsxs("a",{href:"https://pump.fun/8YuADotEATc86nEgPUZVs8fBRxdMMgEP4JL4xv7rpump",target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-400 hover:text-blue-300 flex items-center gap-1",children:["View on Pump.fun",e.jsx(ee,{className:"w-3 h-3"})]})]})]})}),o&&e.jsxs("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl p-6 border border-gray-700",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(A,{className:"w-6 h-6 text-amber-400"}),"Your TYT Holdings"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"Net Balance"}),e.jsxs("div",{className:"text-2xl font-bold text-amber-400",children:[g(o.net_tyt_balance,2)," TYT"]})]}),e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"Total Invested"}),e.jsxs("div",{className:"text-2xl font-bold text-blue-400",children:[o.total_sol_spent.toFixed(4)," SOL"]})]}),e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"Avg Buy Price"}),e.jsxs("div",{className:"text-2xl font-bold text-green-400",children:["$",o.average_buy_price.toFixed(8)]})]})]})]}),r?e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Quick Trade"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("button",{onClick:()=>m("buy"),className:"group p-6 bg-gradient-to-br from-green-500/10 to-emerald-500/10 hover:from-green-500/20 hover:to-emerald-500/20 rounded-xl border border-green-500/30 hover:border-green-500/50 transition-all",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-green-500/20 rounded-xl group-hover:bg-green-500/30 transition-colors",children:e.jsx(D,{className:"w-6 h-6 text-green-400"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-bold text-lg mb-1",children:"Buy TYT"}),e.jsx("div",{className:"text-sm text-gray-400",children:"Purchase TYT tokens with SOL"})]})]})}),e.jsx("button",{onClick:()=>m("sell"),className:"group p-6 bg-gradient-to-br from-red-500/10 to-rose-500/10 hover:from-red-500/20 hover:to-rose-500/20 rounded-xl border border-red-500/30 hover:border-red-500/50 transition-all",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-red-500/20 rounded-xl group-hover:bg-red-500/30 transition-colors",children:e.jsx(L,{className:"w-6 h-6 text-red-400"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-bold text-lg mb-1",children:"Sell TYT"}),e.jsx("div",{className:"text-sm text-gray-400",children:"Sell TYT tokens for SOL"})]})]})})]})]}):e.jsxs("div",{className:"bg-gradient-to-br from-purple-500/10 to-pink-500/10 rounded-xl p-12 border border-purple-500/30 text-center",children:[e.jsx(v,{className:"w-16 h-16 mx-auto mb-4 text-purple-400 opacity-50"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"Connect Your Wallet"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"Connect your Phantom wallet to start trading TYT tokens on Pump.fun"}),e.jsxs("button",{onClick:n,disabled:l,className:"px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 rounded-lg font-semibold hover:from-purple-400 hover:to-pink-400 transition-all disabled:opacity-50 inline-flex items-center gap-2",children:[e.jsx(v,{className:"w-5 h-5"}),"Connect Phantom Wallet"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl border border-gray-700",children:[e.jsx("div",{className:"p-6 border-b border-gray-700",children:e.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(te,{className:"w-6 h-6 text-amber-400"}),"Trade History"]})}),e.jsx("div",{className:"divide-y divide-gray-700",children:w.length===0?e.jsxs("div",{className:"p-12 text-center text-gray-400",children:[e.jsx(A,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No trades yet"}),e.jsx("p",{className:"text-sm mt-2",children:"Start trading to see your history here"})]}):w.map(s=>e.jsx("div",{className:"p-6 hover:bg-gray-800/30 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${s.trade_type==="buy"?"bg-green-500/20":"bg-red-500/20"}`,children:s.trade_type==="buy"?e.jsx(D,{className:"w-6 h-6 text-green-400"}):e.jsx(L,{className:"w-6 h-6 text-red-400"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold capitalize mb-1",children:[s.trade_type," TYT"]}),e.jsx("div",{className:"text-sm text-gray-400",children:new Date(s.created_at).toLocaleString()}),s.tx_signature&&e.jsxs("div",{className:"text-xs text-gray-500 font-mono mt-1",children:[s.tx_signature.slice(0,16),"..."]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:`font-bold text-lg ${s.trade_type==="buy"?"text-green-400":"text-red-400"}`,children:[g(s.tyt_amount,2)," TYT"]}),e.jsxs("div",{className:"text-sm text-gray-400",children:[s.sol_amount.toFixed(4)," SOL"]}),e.jsxs("div",{className:`text-xs font-semibold mt-1 flex items-center justify-end gap-1 ${s.status==="confirmed"?"text-green-400":s.status==="pending"?"text-yellow-400":"text-red-400"}`,children:[s.status==="confirmed"?e.jsx(X,{className:"w-3 h-3"}):s.status==="pending"?e.jsx(N,{className:"w-3 h-3 animate-spin"}):e.jsx(P,{className:"w-3 h-3"}),s.status.toUpperCase()]})]})]})},s.id))})]}),C==="buy"&&e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-900 rounded-xl border border-gray-700 max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx($,{className:"w-6 h-6 text-green-400"}),"Buy TYT"]}),e.jsx("button",{onClick:()=>m(null),className:"text-gray-400 hover:text-white",children:"✕"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-3",children:"SOL Amount"}),e.jsx("input",{type:"number",value:d,onChange:s=>S(s.target.value),placeholder:"0.00",step:"0.01",className:"w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg"})]}),d&&a&&e.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-gray-300 mb-2",children:"You will receive approximately:"}),e.jsxs("div",{className:"text-2xl font-bold text-blue-400",children:[g(z,2)," TYT"]}),e.jsxs("div",{className:"text-xs text-gray-400 mt-2",children:["Price: $",a.price.toFixed(8)," per TYT"]})]}),e.jsxs("div",{className:"bg-yellow-500/10 border border-yellow-500/50 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(P,{className:"w-5 h-5 text-yellow-400 flex-shrink-0 mt-0.5"}),e.jsx("div",{className:"text-sm text-gray-300",children:"Make sure you have enough SOL in your connected wallet. Transaction will be executed on Solana blockchain."})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>m(null),className:"flex-1 px-4 py-3 bg-gray-700 rounded-lg font-semibold hover:bg-gray-600 transition-all",children:"Cancel"}),e.jsx("button",{onClick:O,disabled:!d||parseFloat(d)<=0||p,className:"flex-1 px-4 py-3 bg-green-500 rounded-lg font-semibold hover:bg-green-400 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:p?"Processing...":"Buy TYT"})]})]})]})}),C==="sell"&&e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-900 rounded-xl border border-gray-700 max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx($,{className:"w-6 h-6 text-red-400"}),"Sell TYT"]}),e.jsx("button",{onClick:()=>m(null),className:"text-gray-400 hover:text-white",children:"✕"})]}),e.jsxs("div",{className:"space-y-4",children:[o&&e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-3",children:[e.jsx("div",{className:"text-sm text-gray-400",children:"Available Balance"}),e.jsxs("div",{className:"text-xl font-bold text-amber-400",children:[g(o.net_tyt_balance,2)," TYT"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-3",children:"TYT Amount"}),e.jsx("input",{type:"number",value:x,onChange:s=>E(s.target.value),placeholder:"0.00",step:"any",className:"w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg"})]}),x&&a&&e.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-gray-300 mb-2",children:"You will receive approximately:"}),e.jsxs("div",{className:"text-2xl font-bold text-blue-400",children:[H.toFixed(6)," SOL"]}),e.jsxs("div",{className:"text-xs text-gray-400 mt-2",children:["Price: $",a.price.toFixed(8)," per TYT"]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>m(null),className:"flex-1 px-4 py-3 bg-gray-700 rounded-lg font-semibold hover:bg-gray-600 transition-all",children:"Cancel"}),e.jsx("button",{onClick:W,disabled:!x||parseFloat(x)<=0||p,className:"flex-1 px-4 py-3 bg-red-500 rounded-lg font-semibold hover:bg-red-400 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:p?"Processing...":"Sell TYT"})]})]})]})})]})}export{he as default};
