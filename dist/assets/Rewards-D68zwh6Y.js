import{E as A,r as n,z as H,j as e,J as S,e as F,S as p,k as V,O as $,X as T}from"./index-Cb_Vey4A.js";import{D as G}from"./download-DeDhYPeV.js";import{C as P}from"./calendar-DfOGD8DU.js";import{A as O}from"./activity-XNIBoXMN.js";function X(){const{user:y}=A(),[i,L]=n.useState([]),[M,u]=n.useState(!0),[l,B]=n.useState("30d"),[m,N]=n.useState(""),[v,R]=n.useState("date"),[w,o]=n.useState(null),[a,U]=n.useState(null);n.useEffect(()=>{y&&E()},[y,l]);const E=async()=>{if(y){u(!0);try{let t=H.from("daily_rewards").select(`
          *,
          nft_miners!inner(id, hashrate_th, owner_id, miner_model, tier, rarity)
        `).eq("nft_miners.owner_id",y.id).order("reward_date",{ascending:!1});if(l!=="all"){const h=l==="7d"?7:l==="30d"?30:90,x=new Date;x.setDate(x.getDate()-h),t=t.gte("reward_date",x.toISOString())}const{data:s,error:d}=await t.limit(200);if(d)throw d;s&&L(s)}catch(t){console.error("Error loading rewards:",t)}finally{u(!1)}}},z=()=>{const t=["Date","Miner ID","Hashrate (TH/s)","Gross BTC","Maintenance BTC","Net BTC","USD Value","Merkle Leaf"],s=c.map(r=>[new Date(r.reward_date).toLocaleDateString(),r.miner_id,r.hashrate_snapshot_th,r.gross_btc,r.maintenance_cost_btc,r.net_btc,(parseFloat(r.net_btc)*95e3).toFixed(2),r.merkle_leaf||"Pending"]),d=[t.join(","),...s.map(r=>r.join(","))].join(`
`),h=new Blob([d],{type:"text/csv"}),x=window.URL.createObjectURL(h),b=document.createElement("a");b.href=x,b.download=`tyt-rewards-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(b),b.click(),document.body.removeChild(b),window.URL.revokeObjectURL(x)},c=i.filter(t=>{if(m){const s=m.toLowerCase();return t.miner_id.toLowerCase().includes(s)||t.id.toLowerCase().includes(s)}return!0}).sort((t,s)=>{switch(v){case"date":return new Date(s.reward_date).getTime()-new Date(t.reward_date).getTime();case"net":return parseFloat(s.net_btc)-parseFloat(t.net_btc);case"gross":return parseFloat(s.gross_btc)-parseFloat(t.gross_btc);default:return 0}}),j=i.reduce((t,s)=>t+parseFloat(s.gross_btc),0),_=i.reduce((t,s)=>t+parseFloat(s.maintenance_cost_btc),0),g=i.reduce((t,s)=>t+parseFloat(s.net_btc),0),C=i.length>0?g/i.length:0,f=g*95e3,k=i.slice(0,30).reverse().map(t=>({date:new Date(t.reward_date).toLocaleDateString("en-US",{month:"short",day:"numeric"}),net:parseFloat(t.net_btc),gross:parseFloat(t.gross_btc)})),D=Math.max(...k.map(t=>t.gross));return M?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 border-3 border-amber-400 border-t-transparent rounded-full animate-spin"}),e.jsx("div",{className:"text-gray-400",children:"Loading rewards..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Rewards History"}),e.jsx("p",{className:"text-gray-400",children:"Track and analyze your mining rewards"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>o("chart"),className:"px-4 py-2 bg-blue-500/20 text-blue-400 rounded-lg font-semibold hover:bg-blue-500/30 transition-all flex items-center gap-2",children:[e.jsx(S,{size:18}),"Charts"]}),e.jsxs("button",{onClick:z,className:"px-4 py-2 bg-green-500/20 text-green-400 rounded-lg font-semibold hover:bg-green-500/30 transition-all flex items-center gap-2",children:[e.jsx(G,{size:18}),"Export CSV"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-amber-500/20 to-orange-500/20 rounded-xl p-6 border border-amber-500/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"text-gray-300 text-sm font-medium",children:"Total Net Earnings"}),e.jsx(F,{className:"w-5 h-5 text-amber-400"})]}),e.jsx("div",{className:"text-3xl font-bold text-amber-400 mb-1",children:g.toFixed(8)}),e.jsx("div",{className:"text-sm text-gray-400",children:"BTC"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:["≈ $",f.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl p-6 border border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"text-gray-400 text-sm",children:"Avg Daily Net"}),e.jsx(P,{className:"w-5 h-5 text-amber-400"})]}),e.jsx("div",{className:"text-3xl font-bold text-amber-400 mb-1",children:C.toFixed(8)}),e.jsx("div",{className:"text-sm text-gray-400",children:"BTC/day"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:["≈ $",(C*95e3).toFixed(2),"/day"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl p-6 border border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"text-gray-400 text-sm",children:"Total Gross"}),e.jsx(O,{className:"w-5 h-5 text-amber-400"})]}),e.jsx("div",{className:"text-3xl font-bold text-green-400 mb-1",children:j.toFixed(8)}),e.jsx("div",{className:"text-sm text-gray-400",children:"BTC"}),e.jsx("div",{className:"text-xs text-gray-500 mt-2",children:"Before maintenance"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl p-6 border border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"text-gray-400 text-sm",children:"Maintenance Costs"}),e.jsx(p,{className:"w-5 h-5 text-amber-400"})]}),e.jsx("div",{className:"text-3xl font-bold text-red-400 mb-1",children:_.toFixed(8)}),e.jsx("div",{className:"text-sm text-gray-400",children:"BTC"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:[j>0?(_/j*100).toFixed(1):0,"% of gross"]})]})]}),e.jsx("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl p-6 border border-gray-700",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(V,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",value:m,onChange:t=>N(t.target.value),placeholder:"Search by miner ID...",className:"w-full pl-12 pr-4 py-3 bg-gray-900 border border-gray-700 rounded-lg focus:outline-none focus:border-amber-500 transition-colors"})]}),e.jsxs("select",{value:v,onChange:t=>R(t.target.value),className:"px-4 py-3 bg-gray-900 border border-gray-700 rounded-lg focus:outline-none focus:border-amber-500 transition-colors",children:[e.jsx("option",{value:"date",children:"Sort by Date"}),e.jsx("option",{value:"net",children:"Sort by Net (High to Low)"}),e.jsx("option",{value:"gross",children:"Sort by Gross (High to Low)"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[["7d","30d","90d","all"].map(t=>e.jsx("button",{onClick:()=>B(t),className:`px-4 py-2 rounded-lg font-semibold transition-all text-sm ${l===t?"bg-amber-500 text-black":"bg-gray-900 text-gray-400 hover:bg-gray-800"}`,children:t==="7d"?"7 Days":t==="30d"?"30 Days":t==="90d"?"90 Days":"All Time"},t)),m&&e.jsx("button",{onClick:()=>N(""),className:"px-4 py-2 bg-red-500/20 text-red-400 rounded-lg text-sm hover:bg-red-500/30 transition-all",children:"Clear Search"})]})]})}),c.length===0?e.jsxs("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl p-12 border border-gray-700 text-center",children:[e.jsx(F,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"No Rewards Found"}),e.jsx("p",{className:"text-gray-400",children:m?"Try adjusting your search criteria":"Your rewards will appear here once your miners start earning"})]}):e.jsxs("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl border border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-800/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-400",children:"Date"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-400",children:"Miner"}),e.jsx("th",{className:"px-6 py-4 text-right text-sm font-semibold text-gray-400",children:"Hashrate"}),e.jsx("th",{className:"px-6 py-4 text-right text-sm font-semibold text-gray-400",children:"Gross BTC"}),e.jsx("th",{className:"px-6 py-4 text-right text-sm font-semibold text-gray-400",children:"Maintenance"}),e.jsx("th",{className:"px-6 py-4 text-right text-sm font-semibold text-gray-400",children:"Net BTC"}),e.jsx("th",{className:"px-6 py-4 text-right text-sm font-semibold text-gray-400",children:"USD Value"}),e.jsx("th",{className:"px-6 py-4 text-center text-sm font-semibold text-gray-400",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:c.map(t=>{const s=parseFloat(t.net_btc)*95e3;return e.jsxs("tr",{className:"hover:bg-gray-800/30 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 text-sm",children:new Date(t.reward_date).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"text-sm font-mono text-gray-400",children:["#",t.miner_id.slice(0,8)]})})}),e.jsxs("td",{className:"px-6 py-4 text-sm text-right font-semibold",children:[t.hashrate_snapshot_th," TH/s"]}),e.jsx("td",{className:"px-6 py-4 text-sm text-right font-semibold text-green-400",children:parseFloat(t.gross_btc).toFixed(8)}),e.jsxs("td",{className:"px-6 py-4 text-sm text-right text-red-400",children:["-",parseFloat(t.maintenance_cost_btc).toFixed(8)]}),e.jsx("td",{className:"px-6 py-4 text-sm text-right font-bold text-amber-400",children:parseFloat(t.net_btc).toFixed(8)}),e.jsxs("td",{className:"px-6 py-4 text-sm text-right text-gray-300",children:["$",s.toFixed(2)]}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("div",{className:"flex items-center justify-center gap-2",children:t.merkle_leaf?e.jsx("button",{onClick:()=>{U(t),o("proof")},className:"text-green-400 hover:text-green-300 transition-colors",title:"View Merkle Proof",children:e.jsx($,{size:20})}):e.jsx("span",{className:"text-gray-600 text-xs",children:"Pending"})})})]},t.id)})})]})}),c.length>0&&e.jsxs("div",{className:"px-6 py-4 bg-gray-800/30 border-t border-gray-700 flex items-center justify-between text-sm text-gray-400",children:[e.jsxs("div",{children:["Showing ",c.length," reward",c.length!==1?"s":""]}),e.jsxs("div",{children:["Total: ",g.toFixed(8)," BTC ($",f.toFixed(2),")"]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl p-6 border border-gray-700",children:[e.jsxs("h3",{className:"text-lg font-bold mb-3 flex items-center gap-2",children:[e.jsx(p,{className:"w-5 h-5 text-amber-400"}),"Merkle Proof Verification"]}),e.jsx("p",{className:"text-sm text-gray-400 leading-relaxed",children:"All rewards are recorded with cryptographic Merkle proofs on the blockchain. These proofs ensure complete transparency and allow you to independently verify that your rewards were included in the daily Merkle root. Click the checkmark icon to view and verify the proof for any reward."})]}),w==="proof"&&a&&e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-900 rounded-xl border border-gray-700 max-w-2xl w-full p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(p,{className:"w-6 h-6 text-green-400"}),"Merkle Proof"]}),e.jsx("button",{onClick:()=>o(null),className:"text-gray-400 hover:text-white",children:e.jsx(T,{size:24})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"Reward Date"}),e.jsx("div",{className:"font-semibold",children:new Date(a.reward_date).toLocaleDateString()})]}),e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"Miner ID"}),e.jsx("div",{className:"font-mono text-sm break-all",children:a.miner_id})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"Gross BTC"}),e.jsx("div",{className:"font-bold text-green-400",children:a.gross_btc})]}),e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"Net BTC"}),e.jsx("div",{className:"font-bold text-amber-400",children:a.net_btc})]})]}),e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"Merkle Leaf"}),e.jsx("div",{className:"font-mono text-xs break-all text-gray-300 bg-gray-900 p-3 rounded",children:a.merkle_leaf||"Not yet generated"})]}),a.merkle_proof&&e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"Merkle Proof"}),e.jsx("div",{className:"font-mono text-xs break-all text-gray-300 bg-gray-900 p-3 rounded max-h-32 overflow-y-auto",children:a.merkle_proof})]}),a.merkle_root&&e.jsxs("div",{className:"bg-green-500/10 border border-green-500/50 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-gray-300 mb-2",children:"Merkle Root (On-chain)"}),e.jsx("div",{className:"font-mono text-xs break-all text-green-400",children:a.merkle_root})]}),e.jsx("button",{onClick:()=>o(null),className:"w-full px-4 py-3 bg-gray-700 rounded-lg font-semibold hover:bg-gray-600 transition-all",children:"Close"})]})]})}),w==="chart"&&e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-900 rounded-xl border border-gray-700 max-w-4xl w-full p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(S,{className:"w-6 h-6 text-blue-400"}),"Earnings Chart"]}),e.jsx("button",{onClick:()=>o(null),className:"text-gray-400 hover:text-white",children:e.jsx(T,{size:24})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"Period"}),e.jsx("div",{className:"text-xl font-bold text-amber-400",children:l==="7d"?"7 Days":l==="30d"?"30 Days":l==="90d"?"90 Days":"All Time"})]}),e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"Total Net"}),e.jsxs("div",{className:"text-xl font-bold text-green-400",children:[g.toFixed(6)," BTC"]})]}),e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"USD Value"}),e.jsxs("div",{className:"text-xl font-bold text-blue-400",children:["$",f.toFixed(2)]})]})]}),e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-semibold",children:"Daily Earnings (Last 30 Days)"}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-green-400 rounded-full"}),e.jsx("span",{className:"text-gray-400",children:"Gross"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-amber-400 rounded-full"}),e.jsx("span",{className:"text-gray-400",children:"Net"})]})]})]}),e.jsx("div",{className:"h-64 flex items-end justify-between gap-1",children:k.map((t,s)=>{const d=t.gross/D*100,h=t.net/D*100;return e.jsxs("div",{className:"flex-1 flex flex-col items-center group",children:[e.jsx("div",{className:"w-full flex flex-col items-center justify-end h-full relative",children:e.jsx("div",{className:"w-full bg-green-400/30 hover:bg-green-400/50 transition-all rounded-t relative group",style:{height:`${d}%`},children:e.jsx("div",{className:"absolute bottom-0 w-full bg-amber-400 hover:bg-amber-500 transition-all rounded-t",style:{height:`${h/d*100}%`}})})}),e.jsx("div",{className:"text-xs text-gray-500 mt-2 rotate-45 origin-left whitespace-nowrap",children:t.date})]},s)})})]}),e.jsx("button",{onClick:()=>o(null),className:"w-full px-4 py-3 bg-gray-700 rounded-lg font-semibold hover:bg-gray-600 transition-all",children:"Close"})]})]})})]})}export{X as default};
